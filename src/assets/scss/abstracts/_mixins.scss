// -----------------------------------------------------------------------------
// abstracts/_mixins.scss
// - 공통 믹스인 모음
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;

/* -----------------------------------------------------------------------------
 * full-height (모바일 뷰포트 높이 보정)
 *
 * - iOS/안드 주소창·툴바 변화에도 화면 높이(래퍼 min-height) 안정화
 * - 100vh 기본 → 100dvh 우선 → 미지원 시 --vh로 대체
 * - 최상위 래퍼에 @include full-height;
 * --------------------------------------------------------------------------- */
@mixin full-height {
  min-height: 100vh;
  min-height: 100dvh;

  @supports not (height: 100dvh) {
    min-height: calc(var(--vh, 1vh) * 100);
  }
}

/* -----------------------------------------------------------------------------
 * 반응형 브레이크포인트 사용 가이드
 *
 * 전제(프로젝트 정책)
 * - 최소 대응 폭은 1024px 이상을 기준으로 한다.
 * - 1024 미만(모바일)은 본 프로젝트 범위 밖으로 간주한다.
 *
 * 기준(variables: $desktop)
 * - min: 1024px
 * - default: 1280px
 *
 * 구간 정의
 * - pc-sm: 1024px 이상 ~ 1279px 이하 (작은 PC)
 *   - 1280 미만 구간에서 레이아웃/여백/폰트 보정
 * - pc: 1280px 이상 (기본 PC 시안)
 *   - 기본 레이아웃 폭/여백/그리드 적용
 *
 * 사용 예시:
 *   .container {
 *     // 1024~1279 구간만 보정
 *     @include pc-sm {
 *       padding: 0 16px;
 *     }
 *
 *     // 1280 이상 기본
 *     @include pc {
 *       max-width: 1280px;
 *       margin: 0 auto;
 *     }
 *   }
 * --------------------------------------------------------------------------- */
@mixin pc {
  @media screen and (min-width: map.get(var.$desktop, 'default')) {
    @content;
  }
}

@mixin pc-sm {
  @media screen and (max-width: map.get(var.$desktop, 'default') - 1px) {
    @content;
  }
}

/* ---------------------------------------------------------------------------
 * hoverable-only / common-mouse-event
 * - hoverable-only: 마우스/트랙패드 등 호버 가능한 장치에서만 스타일 적용
 * - common-mouse-event: hover, focus-visible, active에서 동일 스타일 적용
 *   (호버 가능한 장치면 hover + focus/active 적용, 아닌 장치는 focus/active만)
 * - 사용 예:
 *   @include common-mouse-event {
 *     color: red;
 *   }
 * ------------------------------------------------------------------------- */
@mixin hoverable-only {
  @media (any-hover: hover) and (any-pointer: fine) {
    @content;
  }
}

@mixin focus-active {
  &:focus-visible,
  &:active {
    @content;
  }
}

@mixin common-mouse-event {
  @include hoverable-only {
    &:hover {
      @content;
    }
  }

  @include focus-active {
    @content;
  }
}

/* 포지션 믹스인 */
@mixin position($position: absolute, $top: null, $right: null, $bottom: null, $left: null) {
  position: $position;

  @if $top {
    top: $top;
  }

  @if $right {
    right: $right;
  }

  @if $bottom {
    bottom: $bottom;
  }

  @if $left {
    left: $left;
  }
}

/* flex */
@mixin flex($flex: flex, $direction: row, $justify: flex-start, $align: stretch, $wrap: nowrap) {
  display: $flex;
  flex-flow: $direction $wrap;
  align-items: $align;
  justify-content: $justify;
}

/* ---------------------------------------------------------------------------
 * background 믹스인
 * - 역할: 배경 색상, 이미지, 반복, 위치, 크기를 한 번에 설정
 * - 기본값: 
 *     $url: 'none' (이미지 없음)
 *     $color: colors.$color-white
 *     $repeat: no-repeat
 *     $position: center
 *     $size: contain
 * - 사용 시 주의:
 *     배경 이미지를 적용할 경우, 반드시 '/public/resources/img/mro/renewal/' 폴더 기준 경로로 입력
 *     예: "ills/temp.png"
 * - 사용 예시:
 *     @use '@/assets/scss/abstracts/mixins' as mx;
 *     .example {
 *       @include mx.background("ills/temp.png");
 *     }
 * ------------------------------------------------------------------------- */
@mixin background($url: 'none', $color: color.$color-white, $repeat: no-repeat, $position: center, $size: contain) {
  @if $url == 'none' {
    background: $color $repeat $position / $size;
  }
  // stylelint-disable-next-line at-rule-empty-line-before
  @else {
    background: $color url('/public/resources/img/mro/renewal/#{$url}') $repeat $position / $size;
  }
}

/* ---------------------------------------------------------------------------
 * border 믹스인
 * - 역할: 특정 방향 또는 전체에 보더(border) 적용
 * - 기본값:
 *     $direct: bottom (하단 border)
 *     $width: 1px
 *     $style: solid
 *     $color: map.get(colors.$border-colors, 'primary')
 * - 사용 시 주의:
 *     - $width는 px 단위로 입력
 *     - 전체 보더를 적용하려면 $direct: all 사용
 * - 사용 예시:
 *     @use '@/assets/scss/abstracts/mixins' as mx;
 *     .example {
 *       @include mx.border();                  // 하단 1px solid primary
 *       @include mx.border(all, 2px, dashed); // 전체 2px dashed 기본 색상
 *     }
 * ------------------------------------------------------------------------- */
@mixin border($direct: bottom, $width: 1px, $style: solid, $color: map.get(color.$layout-border, 'tertiary')) {
  @if $direct == 'all' {
    border: $width $style $color;
  }
  // stylelint-disable-next-line at-rule-empty-line-before
  @else {
    border-#{$direct}: $width $style $color;
  }
}

/* 스크린 리더 전용 숨김 처리 */
@mixin sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  clip-path: inset(50%) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* 말줄임 - 한 줄 */
@mixin ellipsis-single {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 말줄임 - 2줄 이상 */
@mixin ellipsis-multi($line-height: 1.4, $ea: 2, $text-overflow: true) {
  display: -webkit-box;
  max-height: calc(#{$line-height}em * #{$ea});
  overflow: hidden;
  line-height: $line-height;

  @if $text-overflow == true {
    text-overflow: ellipsis;
    -webkit-line-clamp: #{$ea};
  }
  -webkit-box-orient: vertical;
}

/* 한국어/영어 모두 안전하게 개행 */
@mixin text-wrap-safe {
  word-break: keep-all;
  overflow-wrap: anywhere;
}

/* media-box: 미디어 박스 공통 규칙 */
@mixin media-box($fit: contain, $ratio: null, $w: null, $h: null, $overflow: null, $pos: 50% 50%, $bg: null) {
  @if $w {
    width: $w;
  }

  @if $h {
    height: $h;
  }

  @if $ratio {
    aspect-ratio: $ratio;
  }

  @if $bg {
    background: $bg;
  }

  @if $overflow {
    overflow: $overflow;
  }

  img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: $fit;
    object-position: $pos;
  }
}

/* divider */
@mixin divider($item: 'li', $w: 1, $h: 12, $gap: 12, $color: map.get(color.$gray-shades, '30')) {
  @include flex(flex, row, flex-start, center);

  > #{$item} {
    &:not(:only-of-type, :last-of-type) {
      padding-right: fn.rem($gap);
    }

    & + #{$item} {
      position: relative;
      padding-left: fn.rem($gap);

      &::before {
        @include position(absolute, $top: 50%, $left: 0);
        width: fn.rem($w);
        height: fn.rem($h);
        content: '';
        background-color: $color;
        transform: translateY(-50%);
      }
    }
  }
}

/* input search 초기화 */
@mixin input-search-reset($color: map.get(color.$text-colors, 'quaternary')) {
  input[type='search'] {
    appearance: none;
    background: transparent;
    border: 0;
    border-radius: 0;
    outline: 0;

    &::placeholder {
      color: $color;
    }

    &::-webkit-search-decoration,
    &::-webkit-search-cancel-button,
    &::-webkit-search-results-button,
    &::-webkit-search-results-decoration {
      appearance: none;
    }
  }
}

/* object-fit 타입을 파라미터로 받기 */
@mixin img-fit($fit: contain) {
  img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: $fit;
    object-position: center;
  }
}

/* 상품 아이템 이미지 공통 속성 */
@mixin common-list-thumb(
  $thumb-bg-color: map.get(color.$gray-shades, '30'),
  $img-bg-color: map.get(color.$gray-shades, '0')
) {
  @include img-fit;
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  background-color: $thumb-bg-color;

  img {
    background-color: $img-bg-color;
  }
}

@mixin bullet-style($pl: 12, $top: 7, $w: 4, $h: $w, $bg: map.get(color.$layout-surf, 'secondary'), $gap: 8) {
  > li {
    position: relative;
    padding-left: fn.rem($pl);

    &::before {
      @include position(absolute, #{$top}px, $left: 0);

      @if $w != 0 {
        width: fn.rem($w);
        height: fn.rem($h);
        content: '';
        background: $bg;
        border-radius: 50%;
      }
    }

    & + li {
      margin-top: fn.rem($gap);
    }
  }
}

/* 스크롤바 숨기기 */
@mixin pc-hide-scrollbar {
  @at-root html.is-pc & {
    scrollbar-width: none;

    &::-webkit-scrollbar {
      display: none;
    }
  }
}

// 스크롤 가능하되 스크롤바 숨김
@mixin hidden-scrollbar {
  &::-webkit-scrollbar {
    display: none;
  }
  scrollbar-width: none;
  -ms-overflow-style: none;
}
