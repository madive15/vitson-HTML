// -----------------------------------------------------------------------------
// layout/_header.scss
// - 헤더 내부 UI 전용. 레이아웃(높이/배치)은 layout/_wrapper.scss에서만 제어.
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

$header-rank-height: fn.rem(24);
$header-rank-bar-height: fn.rem(18);
$header-search-width: fn.rem(380);
$header-search-panel-right: fn.rem(200);
$header-common-gap: map.get(var.$unit, 32);

@mixin gnb-btn-active-style {
  .icon {
    color: map.get(color.$brand-colors, 'primary');
  }

  .text {
    color: map.get(color.$brand-colors, 'primary');
  }
}

.vits-header {
  @include mx.border($color: map.get(color.$border-colors, 'quaternary'));
  position: relative;
  background: color.$color-white;

  &-topbar {
    @include mx.flex(flex, row, flex-start, center);
    @include mx.border($color: map.get(color.$gray-shades, '30'));
    height: var.$header-topbar-height;

    .vits-inner {
      @include mx.flex(flex, row, space-between, center);
    }

    .header-topbar {
      &-right {
        @include mx.divider($h: 8);

        &-spacer {
          a + a {
            margin-left: map.get(var.$unit, 24);
          }
        }
      }
    }
  }

  &-main {
    @include mx.flex(flex, row, flex-start, center);
    height: var.$header-main-height;

    .vits-inner {
      @include mx.flex(flex, row, space-between, center);
    }

    .header-main {
      &-logo {
        display: block;
        width: fn.rem(144);
      }

      &-search {
        @include mx.flex(flex, row, center, center);
        gap: map.get(var.$unit, 20);

        /* 실시간 검색어 */
        &-rank {
          position: relative;
          width: fn.rem(140);

          .header-rank {
            &-bar {
              @include mx.flex(flex, row, flex-start, center);
              gap: map.get(var.$unit, 8);
              height: $header-rank-bar-height;
            }

            &-link {
              @include mx.flex(inline-flex, row, flex-start, center);
              min-width: 0;
              margin-right: auto;
            }

            /* 2줄을 쌓아두는 트랙(여기만 움직임) */
            &-track {
              display: block;
              transition: transform 0.6s ease; /* JS data-rank-duration과 맞추기 */
              transform: translateY(0);
              will-change: transform;
            }

            /* 롤링 뷰(마스킹) */
            &-view {
              display: block;
              width: 100%;
              height: $header-rank-height;
              overflow: hidden;

              /* 롤링 상태: 트랙을 한 줄만큼 올림 */
              &.is-rolling .header-rank-track {
                transform: translateY(-#{$header-rank-height});
              }
            }

            /* 한 줄(현재/다음) */
            &-row {
              @include mx.flex(flex, row, flex-start, center);
              gap: map.get(var.$unit, 8);
              height: $header-rank-height;
              line-height: $header-rank-height;
            }

            &-num {
              @include typo.typography('b3sb', $color: map.get(color.$brand-colors, 'primary'));
            }

            &-word {
              @include typo.typography('b3r', $color: map.get(color.$text-colors, 'default'));
              @include mx.ellipsis-single;
            }

            &-move {
              &::before {
                @include typo.typography('b3r', $color: map.get(color.$text-colors, 'default'));
                display: block;
              }

              &.rank-move-up::before {
                color: map.get(color.$brand-colors, 'primary');
                content: '\2191';
              }

              &.rank-move-down::before {
                color: map.get(color.$blue-shades, '100');
                content: '\2193';
              }

              &.rank-move-same::before {
                content: '-';
              }
            }

            /* 토글 버튼 */
            &-btn {
              @include button.btn-reset;
              @include icon.ic-size(fn.rem(16));
              box-sizing: content-box;
              flex-shrink: 0;
              padding: map.get(var.$unit, 4);
              margin: -#{map.get(var.$unit, 4)};
              color: map.get(color.$brand-colors, 'primary');
              transition: transform 0.4s;
            }

            /* 패널(toggle.js: is-open 사용) */
            &-panel {
              position: absolute;
              top: $header-rank-bar-height;
              left: 0;
              z-index: var.$zindex-header-rank;
              min-width: 260px;
              padding: 12px;
              background: #fff;
              border: 1px solid #dadada;
              border-radius: 8px;

              &-head {
                display: flex;
                gap: 12px;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 8px;
              }

              &-close {
                padding: 0;
                cursor: pointer;
                background: transparent;
                border: 0;
              }

              &:not(.is-open) {
                max-height: 0;
              }
            }
          }

          &:has(.header-rank-panel.is-open) {
            .header-rank-btn {
              transform: rotate(180deg);
            }
          }
        }

        /* 통합 검색어창 */
        &-form {
          position: relative;

          .header-search {
            &-input {
              @include mx.flex(flex, row, space-between, center);
              @include mx.border('all', $width: 2px, $color: map.get(color.$border-colors, 'primary'));
              @include mx.input-search-reset;
              gap: map.get(var.$unit, 8);
              width: $header-search-width;
              height: fn.rem(40);
              padding: 0 map.get(var.$unit, 20);
              background: color.$color-white;
              border-radius: map.get(var.$radius, 'sm');
            }

            &-field {
              @include typo.typography('b3r');
              flex-grow: 1;
            }

            &-submit {
              @include button.btn-reset;
              @include icon.ic-size(map.get(var.$unit, 24));
              margin-right: -#{map.get(var.$unit, 2)};
            }

            &-panel {
              @include mx.position(absolute, 100%, $left: 0);
              @include mx.border('all');
              z-index: var.$zindex-header-search;
              width: $header-search-width;
              background: color.$color-white;

              .search-panel {
                &-left {
                  width: $header-search-width;
                }

                &-right {
                  @include mx.position(absolute, 0, 0);
                  width: $header-search-panel-right;
                  padding: 12px;
                  border-left: 1px solid #eee;
                }
              }

              &.is-open {
                &:has(.search-panel-right.is-active) {
                  width: $header-search-width + $header-search-panel-right;
                }
              }
            }
          }
        }
      }

      &-util {
        @include mx.flex;
        gap: map.get(var.$unit, 12);
      }
    }
  }

  &-gnb {
    position: relative;

    .gnb {
      &-bar {
        @include mx.flex(flex, row, flex-start, flex-start);
        gap: $header-common-gap;
      }

      &-link {
        @include mx.flex(flex, row, flex-start, center);
        @include typo.typography('h4s');
        flex-shrink: 0;
        height: var.$header-gnb-height;
        padding: 0 $header-common-gap;
      }

      /* 오버플로우 판정 대상(홈+프로모션) */
      &-nav {
        @include mx.flex(flex, row, flex-start, flex-start);
        flex-grow: 1;
        min-width: 0;

        // max-width: max-content;
        max-height: var.$header-gnb-height;
        overflow: hidden;

        &-list {
          @include mx.flex(flex, row, flex-start, flex-start);
          width: 100%;
          min-width: 0;
        }

        /* 펼침: 목록은 필요 시 다음 줄로 내려가도 됨(wrap), 각 링크 텍스트는 1줄(말줄임) */
        &.is-expanded {
          max-height: var.$header-gnb-full-height;
          overflow: hidden auto;

          .gnb-link {
            @include mx.ellipsis-single;
            display: inline-flex;
            max-width: 100%;

            &:has(.exhibition-item-sub) {
              flex-direction: column;
              align-items: flex-start;
              justify-content: center;

              .exhibition-item {
                &-sub {
                  @include typo.typography('h4s');
                  font-style: normal;
                }

                &-text {
                  @include typo.typography('b2r', $color: map.get(color.$text-colors, 'quaternary'));
                }
              }
            }
          }
        }
      }

      &-item {
        &:not(.gnb-item-promo-list) {
          flex: 0 0 auto;
        }

        // 기획전 페이지 나열
        &.gnb-item-promo-list {
          @include mx.flex(flex, row, flex-start, stretch);
          flex: 1 1 auto;
          min-width: 0;

          .gnb-promo-list {
            @include mx.flex;
            flex: 0 1 auto;
            min-width: 0;
            overflow: hidden;

            .gnb-link.is-hidden {
              display: none;
            }
          }
        }
      }

      /* 가획전, 이벤트 목록 */
      &-fixed-list {
        @include mx.flex;
        flex-shrink: 0;
        max-width: max-content;
      }

      &-left {
        @include mx.flex(flex, row, flex-start, center);
        flex-shrink: 0;
        gap: $header-common-gap;
      }

      /* 전체카테고리, 브랜드 버튼 */
      &-btn {
        @include button.btn-reset;
        @include mx.flex(flex, row, center, center);
        gap: map.get(var.$unit, 4);
        height: var.$header-gnb-height;

        .icon {
          @include icon.ic-size(fn.rem(24));
          color: map.get(color.$icon-neutral-colors, 'primary');
          transition: transform 0.3s;
          will-change: transform;
        }

        .text {
          @include typo.typography('h4s', $color: map.get(color.$neutral-colors, '1'));
        }

        &.category .icon.left {
          @include icon.ic-size(fn.rem(28));
        }

        &[aria-expanded='true'] {
          @include gnb-btn-active-style;

          .icon.right {
            transform: rotate(180deg);
          }
        }

        @include mx.common-mouse-event {
          @include gnb-btn-active-style;
        }
      }

      /* 더보기(+) */
      &-more {
        @include button.btn-reset;
        @include icon.ic-size(fn.rem(28));
        flex-shrink: 0;
        margin-top: calc((var.$header-gnb-height - fn.rem(28)) / 2);
        margin-left: auto;
        transition: transform 0.3s;
        will-change: transform;

        // 공통 “강조 상태” 스타일(aria-expanded/hover 공용)
        @mixin more-active-style {
          color: map.get(color.$brand-colors, 'primary');
          transform: rotate(45deg * 4);
        }

        &[aria-expanded='true'] {
          @include more-active-style;
        }

        @include mx.common-mouse-event {
          @include more-active-style;
        }

        &-box {
          display: none;
          flex: 0 0 auto;

          &.is-active {
            display: block;
          }
        }
      }

      &-panel {
        @include mx.position(absolute, 100%, $left: 0);
        @include mx.border;
        z-index: var.$zindex-header-panel;
        width: 100%;
        background: map.get(color.$gray-shades, '30');

        &.is-open {
          max-height: var.$header-panel-height-max;
        }

        /* 기획전 리스트 */
        &.gnb-panel-more {
          position: static;
          background: map.get(color.$gray-shades, '40');

          .gnb-panel-list {
            @include mx.flex(flex, row, flex-start, flex-start, wrap);
          }
        }
      }
    }

    &.is-more-visible {
      .gnb-more-box {
        display: block;
      }
    }
  }
}

// 디자인 나오면 수정하기
// == 실시간 검색어 ==
/* 리스트 */
.header-rank-list {
  padding: 0;
  margin: 0;
  list-style: none;
}

.header-rank-item + .header-rank-item {
  margin-top: 6px;
}

.header-rank-item-link {
  display: inline-flex;
  gap: 8px;
  align-items: center;
  color: inherit;
  text-decoration: none;
}

// == 통합 검색어 ==
/* 패널 내부 3칸: 좌(고정) + 가운데(여백) + 우(고정) */
.search-panel-wrap {
  display: flex;
  align-items: stretch;
}

/* 우측 상품목록: 기본 숨김, 활성화 시만 표시(맨 오른쪽 끝에 붙음) */
/* 최근 검색어 */
.search-recent {
  padding: 12px;

  .search-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .search-keyword-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;

    li {
      display: flex;
      gap: 4px;
      align-items: center;
      padding: 4px 8px;
      border: 1px solid #eee;
      border-radius: 12px;
    }
  }
}

/* 연관 검색어 */
.search-related {
  padding: 12px;
  border-top: 1px solid #eee;

  .search-title {
    display: block;
    margin-bottom: 8px;
  }
}

.search-related-item {
  padding: 10px 8px;
  cursor: pointer;

  &:hover {
    background: #f6f6f6;
  }
}

.search-related-label {
  display: block;
  font-size: 12px;
  line-height: 1.3;
  color: #888;
  word-break: break-word;
}

.search-related-label em {
  font-style: normal;
  color: #ff6a00;
}

.search-related-text {
  display: block;
  margin-top: 4px;
  font-size: 14px;
  line-height: 1.4;
  color: #222;

  &:empty {
    display: none;
  }

  em {
    font-style: normal;
    color: #ff6a00;
  }
}

/* 우측 상품목록 패널(내용 전환) */
.related-products-panel {
  display: none;
}

.related-products-panel.is-active {
  display: block;
}

/* 더미 상품 카드 */
.related-products-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.product-card a {
  display: block;
  color: inherit;
  text-decoration: none;
}

.product-card .thumb {
  display: block;
  width: 100%;
  padding-top: 100%;
  background: #f2f2f2;
  border-radius: 8px;
}

.product-card .name {
  display: block;
  margin-top: 6px;
  font-size: 13px;
  line-height: 1.3;
}

/* header gnb */

.vits-header-gnb {
  /* 접힘(클리핑 룰): JS가 상태/폭을 제어 */

  .gnb-link.is-clip {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;

    /* max-width는 JS가 "보이는 폭" 기준으로 인라인 지정 */
  }

  .gnb-nav.is-expanded .gnb-nav-list {
    flex-wrap: wrap; /* 항목 줄바꿈 허용 */
    min-width: 0;
    white-space: normal;
  }

  /* 펼침에서 "한 항목이 부모 100%를 넘어가는 경우"만 말줄임 처리 */
  .gnb-nav.is-expanded .gnb-item {
    max-width: 100%;
  }

  .gnb-panel-inner {
    padding: 16px;
  }
}
