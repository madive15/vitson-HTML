// -----------------------------------------------------------------------------
// layout/_list.scss
// - 반복 리스트(가로/세로) 배치 및 gap 간격 패턴만 공통 관리. (아이템 UI 제외)
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

$list-gap: 12, 16, 18;

// 방향별 기본 스타일
$list-directions: (
  row: (
    display: flex,
    flex-direction: row,
    flex-wrap: wrap
  ),
  column: (
    display: flex,
    flex-direction: column
  )
);

@mixin common-list-gap {
  display: flex;

  // gap 클래스 자동 생성: .list-row-gap16, .list-column-gap18
  @each $gap in $list-gap {
    &-gap#{$gap} {
      gap: fn.rem($gap);
    }
  }
}

// 조합 클래스만 생성: 예) .list-row-gap16, .list-column-gap18
@each $name, $props in $list-directions {
  @each $gap in $list-gap {
    .list-#{$name}-gap#{$gap} {
      // 방향별 기본 속성 출력
      @each $prop, $value in $props {
        #{$prop}: #{$value};
      }
      gap: fn.rem($gap);
    }
  }
}

@mixin common-product-card-info {
  .product {
    &-thumb {
      position: relative;
      aspect-ratio: 1 / 1;
      background: map.get(color.$gray-shades, '30');

      img {
        @include mx.common-list-thumb;
      }
    }

    &-frequent {
      &-count {
        @include mx.flex(inline-flex, row, center, center);
        @include typo.typography('b4s', $color: map.get(color.$text-status, 'info'));
        height: fn.rem(28);
        padding: 0 map.get(var.$unit, 8);
        background: map.get(color.$layout-status, 'info-bg-sub');
        border-radius: map.get(var.$radius, 'sm');
      }

      &-date {
        @include typo.typography('b4s', $color: map.get(color.$text-status, 'info-soft'));
      }
    }

    &-code {
      @include mx.flex(inline-flex, row, center, center);
      @include mx.border('all', $color: map.get(color.$layout-border, 'tertiary'));
      @include typo.typography('b5r', $color: map.get(color.$text-colors, 'tertiary'));
      min-width: 0;
      height: map.get(var.$unit, 16);
      padding: 0 map.get(var.$unit, 4);
    }

    &-actions {
      @include mx.flex(flex, row, flex-end, center);

      button[class*='product-action-'] {
        @include button.btn-reset;
        color: map.get(color.$icon-neutral, 'tertiary');

        .ic {
          display: block;
          background-color: currentcolor;
          mask: no-repeat center / contain;
          transition: color 0.3s;
        }

        // 좋아요
        &[class*='-like'] .ic {
          mask-image: url('/public/resources/img/mro/renewal/ic/ic-heart.svg');

          @include mx.focus-active {
            mask-image: url('/public/resources/img/mro/renewal/ic/ic-heart-fill.svg');
          }
        }

        &[class*='-like'].active .ic {
          color: map.get(color.$icon-colors, 'primary');
          mask-image: url('/public/resources/img/mro/renewal/ic/ic-heart-fill.svg');
        }

        // 장바구니
        &[class*='-cart'] {
          /* stylelint-disable-next-line no-descending-specificity */
          .ic {
            mask-image: url('/public/resources/img/mro/renewal/ic/ic-bag.svg');
          }

          @include mx.common-mouse-event {
            .ic {
              mask-image: url('/public/resources/img/mro/renewal/ic/ic-bag-on.svg');
            }
          }
        }

        // 비교함 담기
        &[class*='-compare'] {
          /* stylelint-disable-next-line no-descending-specificity */
          .ic {
            mask-image: url('/public/resources/img/mro/renewal/ic/ic-compare.svg');
          }

          @include mx.common-mouse-event {
            color: map.get(color.$icon-neutral, 'primary');

            .text {
              color: map.get(color.$icon-neutral, 'primary');
            }
          }
        }

        &:not([class*='-compare']) {
          @include mx.common-mouse-event {
            color: map.get(color.$icon-colors, 'primary');

            .text {
              color: map.get(color.$icon-colors, 'primary');
            }
          }
        }
      }
    }

    &-brand {
      @include typo.typography('b4r', $color: map.get(color.$text-colors, 'secondary'));
    }

    &-name {
      @include typo.typography('b3s', $color: map.get(color.$text-colors, 'primary'));
      @include mx.ellipsis-multi(1.4, 2);
    }

    &-spec {
      @include typo.typography('b4r', $color: map.get(color.$text-colors, 'secondary'));
    }

    &-price {
      .price-origin-label {
        @include typo.typography('d3r', $color: map.get(color.$text-colors, 'tertiary'));
        text-decoration: line-through;
        text-decoration-line: line-through;
      }

      .price-sale-row {
        @include mx.flex(flex, row, flex-start, center, wrap);
        gap: map.get(var.$unit, 4);

        .price-rate {
          @include typo.typography('b1b', $color: map.get(color.$text-status, 'brand'));
        }

        .price-sale {
          @include typo.typography('b1b', $color: map.get(color.$text-colors, 'primary'));
        }
      }

      .product-price-alt.is-soldout {
        @include typo.typography('b1b', $color: map.get(color.$label-shipping, 'today'));
      }

      .product-price-alt.is-guest {
        @include mx.flex(flex, column, flex-start, flex-start);
        gap: map.get(var.$unit, 12);

        .price-guest-text {
          @include mx.flex(flex, column, flex-start, flex-start);
          gap: map.get(var.$unit, 2);

          &-title {
            @include typo.typography('b4s', $color: map.get(color.$text-status, 'info-sub'));
          }

          &-desc {
            @include typo.typography('b4r', $color: map.get(color.$text-colors, 'secondary'));
          }
        }

        .price-guest-action {
          width: 100%;

          .price-login-button {
            @include button.btn-reset;
            @include mx.flex(flex, row, center, center);
            @include mx.border('all', $color: map.get(color.$layout-border, 'tertiary'));
            gap: fn.rem(10);
            width: 100%;
            height: fn.rem(34);
            padding: 0 map.get(var.$unit, 8);
            border-radius: map.get(var.$radius, 'sm');

            .icon {
              @include icon.ic-size(map.get(var.$unit, 16));
              color: map.get(color.$icon-neutral, 'primary');
            }

            .text {
              @include typo.typography('b3r', $color: map.get(color.$text-colors, 'tertiary'));
            }

            // 마우스 오버시 추가 02.11
            @include mx.hoverable-only {
              &:hover {
                background-color: map.get(color.$layout-surf, 'sunken');
                border-color: map.get(color.$layout-border, 'primary');

                .text {
                  color: map.get(color.$layout-border, 'primary');
                }
              }
            }
          }
        }
      }
    }

    &-extra {
      @include mx.flex(flex, row, flex-start, center, wrap);
      gap: map.get(var.$unit, 2);
    }
  }
}

/* form list */
@mixin form-dl-cst($dt, $mh, $pt, $gx, $gy, $typo, $color) {
  @include mx.flex(flex, row, flex-start, flex-start, wrap);
  gap: fn.rem($gy) fn.rem($gx);

  > dt {
    @include typo.typography($typo, $color: $color);
    width: fn.rem($dt);
    min-height: fn.rem($mh);
    padding-top: fn.rem($pt);

    & + dd {
      width: calc(100% - fn.rem($dt) - fn.rem($gx));
    }
  }
}

/* 상품 목록 리스트 */
/* 상품 카드 아이템 */
[class*='vits-product-card'] {
  @include common-product-card-info;

  .product {
    &-body {
      display: grid;
    }

    &-meta {
      @include mx.flex(flex, row, space-between, center);
    }

    &-model {
      @include typo.typography('b4r', $color: map.get(color.$text-colors, 'muted'));
    }

    &-spec {
      margin-top: map.get(var.$unit, 2);
    }
  }
}

.vits-product {
  &-section,
  &-list {
    @include mx.flex(flex, column);
  }

  &-section {
    gap: map.get(var.$unit, 24);
  }

  &-list {
    gap: map.get(var.$unit, 40);
  }

  &-pagination {
    @include mx.flex(flex, row, center, center);
  }
}

// 썸네일형
.vits-product-list.view-thumb {
  .vits-product {
    &-list-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: map.get(var.$unit, 24);
      align-items: stretch;
    }

    &-item {
      position: relative;
      align-self: stretch;

      .vits-checkbox-item {
        @include mx.position(absolute, 4px, $left: 4px);
        z-index: var.$zindex-base;
      }

      &.type-wide {
        grid-column: 1 / -1;
      }
    }
  }

  [class*='vits-product-card'] {
    @include mx.flex(flex, column, flex-start, flex-start);
    gap: map.get(var.$unit, 12);

    .product {
      &-thumb {
        width: 100%;
      }

      &-body {
        grid-template-areas:
          'code actions'
          'meta meta'
          'summary summary'
          'price price'
          'extra extra';
        grid-template-columns: minmax(0, 1fr) auto;
        gap: map.get(var.$unit, 8) 0;
        width: 100%;
      }

      &-code {
        grid-area: code;
        place-self: center start;
        min-width: 0;
      }

      &-actions {
        grid-area: actions;
        gap: map.get(var.$unit, 8);
        place-self: center end;

        button[class*='product-action-'] {
          @include mx.flex(flex, row, center, center);

          .ic {
            width: map.get(var.$unit, 24);
            height: map.get(var.$unit, 24);
          }

          .text {
            @include mx.sr-only;
          }
        }
      }

      &-meta {
        grid-area: meta;
        padding-top: map.get(var.$unit, 4);
      }

      &-summary {
        grid-area: summary;
      }

      &-price {
        grid-area: price;

        .product-price-alt.is-guest {
          margin-top: map.get(var.$unit, 4);
        }
      }

      &-extra {
        grid-area: extra;
        margin-top: map.get(var.$unit, 4);
      }
    }
  }

  // 좋아요/자주구매 상품 리스트
  &[data-context='like'],
  &[data-context='frequent'] {
    .vits-product {
      &-list-items {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }
  }

  // 썸네일 - 자주구매 상품 리스트
  &[data-context='frequent'] [class*='vits-product-card'] {
    .product {
      &-body {
        grid-template-areas:
          'frequent frequent'
          'code actions'
          'meta meta'
          'summary summary'
          'price price'
          'extra extra';
        grid-template-columns: minmax(0, 1fr) auto;
        gap: map.get(var.$unit, 8) 0;
        width: 100%;
      }

      &-aside {
        display: contents;
      }

      &-frequent {
        @include mx.flex(flex, row, space-between, center, wrap);
        grid-area: frequent;
        gap: map.get(var.$unit, 4);
        margin-bottom: map.get(var.$unit, 4);
      }
    }
  }
}

// 리스트형
.vits-product-list.view-list {
  .vits-product {
    &-list-items {
      @include mx.flex(flex, column, flex-start, flex-start);
    }

    &-item {
      @include mx.border('bottom', $color: map.get(color.$layout-surf, 'secondary'));
      width: 100%;
      padding: map.get(var.$unit, 16) 0;

      &:first-of-type {
        @include mx.border('top', $color: map.get(color.$layout-surf, 'secondary'));
      }
    }
  }

  [class*='vits-product-card'] {
    @include mx.flex(flex, row, flex-start, stretch);
    gap: map.get(var.$unit, 20);

    .product {
      &-thumb {
        flex: 0 0 fn.rem(160);
      }

      /* stylelint-disable-next-line no-descending-specificity */
      &-body {
        flex-grow: 1;
        min-width: 0;
      }

      &-code {
        width: fit-content;
      }

      &-actions {
        gap: map.get(var.$unit, 16);
        justify-content: center;

        button[class*='product-action-'] {
          @include mx.flex(flex, column, center, center);
          gap: map.get(var.$unit, 8);
          text-align: center;

          .ic {
            width: map.get(var.$unit, 32);
            height: map.get(var.$unit, 32);
          }

          .text {
            @include typo.typography('b4r', $color: map.get(color.$neutral-colors, '1'));
          }
        }
      }

      &-price,
      &-actions {
        position: relative;
        display: flex;
        place-self: stretch;
        justify-content: center;
        width: 100%;
        height: 100%;

        &::before {
          @include mx.position(absolute, 0, $left: calc(41px / 2 * -1), $bottom: 0);
          width: 1px;
          content: '';
          background: map.get(color.$layout-surf, 'secondary');
        }
      }

      &-price {
        flex-direction: column;
      }

      &-summary {
        @include mx.flex(flex, column);
        gap: map.get(var.$unit, 2);
        padding: map.get(var.$unit, 2) 0 map.get(var.$unit, 8);
      }

      &-extra {
        align-self: flex-end;
      }
    }

    // 회원용 그리드 템플릿
    &.is-member {
      .product {
        &-body {
          grid-template:
            'meta    price actions' auto
            'summary price actions' auto
            'code    price actions' auto
            'extra   price actions' 1fr
            / 35.51% 29.23% 24.1%;
          column-gap: 41px;
        }

        &-actions {
          grid-area: actions;
        }

        &-meta {
          grid-area: meta;
        }

        &-summary {
          grid-area: summary;
        }

        &-code {
          grid-area: code;
        }

        &-price {
          grid-area: price;
        }

        &-extra {
          grid-area: extra;
        }
      }
    }

    // 비회원용 그리드 템플릿
    &.is-guest {
      .product {
        &-body {
          grid-template-rows: auto auto auto 1fr;
          grid-template-columns: 35.51% 29.23% 24.1%;
          column-gap: 41px;
        }

        &-meta {
          grid-area: 1 / 1;
        }

        &-summary {
          grid-area: 2 / 1;
        }

        &-code {
          grid-area: 3 / 1;
        }

        &-price {
          grid-row: 1 / 5; // 1~4번째 행
          grid-column: 2 / 4; // 2~3번째 컬럼
          align-items: flex-end;

          .product-price-alt.is-guest {
            width: 45.19%;
          }

          .product-price-alt.is-guest,
          .price-guest-text {
            align-items: center;
          }
        }
      }
    }
  }

  // 썸네일 - 자주구매 상품 리스트
  &[data-context='frequent'] {
    .vits-product {
      &-list-items {
        gap: map.get(var.$unit, 32);
      }

      &-item {
        padding: 0;
        border-bottom: 0;

        &:first-of-type {
          border-top: 0;
        }
      }
    }

    [class*='vits-product-card'] {
      .product {
        &-body {
          grid-template:
            'meta    frequent aside' auto
            'summary frequent aside' auto
            'code    frequent aside' auto
            'extra   frequent aside' 1fr
            / 39.48% 21.86% 27.32%;
          column-gap: 41px;
        }

        &-thumb {
          flex-basis: fn.rem(140);
        }

        &-aside {
          @include mx.flex(flex, column, center, center);
          grid-area: aside;
          gap: map.get(var.$unit, 20);
          align-self: center;
        }

        &-actions,
        &-price {
          align-self: center;

          &::before {
            display: none;
          }
        }

        &-actions {
          justify-content: flex-end;

          /* stylelint-disable-next-line no-descending-specificity */
          .ic {
            width: map.get(var.$unit, 24) !important;
            height: map.get(var.$unit, 24) !important;
          }

          .text {
            @include mx.sr-only;
          }
        }

        &-price {
          align-items: flex-end;

          .vits-price-box {
            @include mx.flex(flex, column, flex-end, flex-end);
          }
        }

        &-meta {
          grid-area: meta;
        }

        &-summary {
          grid-area: summary;
        }

        &-code {
          grid-area: code;
        }

        &-frequent {
          @include mx.flex(flex, column-reverse, center, center);
          position: relative;
          grid-area: frequent;
          gap: map.get(var.$unit, 8);

          &-count {
            width: 100%;
            font-size: fn.rem(14);
          }

          &::before,
          &::after {
            @include mx.position(absolute, 0, $bottom: 0);
            width: 1px;
            content: '';
            background: map.get(color.$layout-surf, 'secondary');
          }

          &::before {
            left: calc(41px / 2 * -1);
          }

          &::after {
            right: calc(41px / 2 * -1);
          }
        }
      }
    }
  }
}
