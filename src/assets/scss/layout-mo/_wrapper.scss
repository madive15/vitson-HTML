// -----------------------------------------------------------------------------
// layout-mo/_wrapper.scss
// - 모바일 공통 레이아웃 기준(수정 금지): 래퍼 프레임 + 뷰포트/세이프영역/하단바 여백.
// - sticky는 '문서(body) 스크롤' 기준으로 운용하며, wrap/wrapper에는 overflow를 두지 않는다.
// - 바텀바 타입 추가 시 $mo-bottom-bar 맵에 키 추가 → 여백 자동 반영.
// - 화면별 예외는 wrap-{페이지} 확장 클래스로만 처리.
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/base/colors' as color;

// --- 믹스인 ---
@mixin vh-full {
  min-height: calc(var(--vh) * 100);
}

@mixin bottom-bar-spacing($property: padding-bottom, $bottom-bar-h: 0) {
  #{$property}: calc(#{$bottom-bar-h} + var(--safe-bottom));
}

// --- CSS 변수 (런타임) ---
:root {
  --vh: 1dvh;
  --safe-top: env(safe-area-inset-top, 0);
  --safe-bottom: env(safe-area-inset-bottom, 0);
  --safe-left: env(safe-area-inset-left, 0);
  --safe-right: env(safe-area-inset-right, 0);
}

// --- 모바일 스코프 기본 ---
.vm-scope {
  -webkit-tap-highlight-color: transparent;
  text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html.vm-scope,
html.vm-scope body {
  min-width: 0;
  height: 100%;
  padding: 0;
  margin: 0;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

// --- 전체 래퍼 (운영 영역, 클래스 추가 불가) ---
.vm-wrapper {
  position: relative;
}

// --- 제어 래퍼 (1depth 스코프, 상태 클래스 대상) ---
.vm-wrap {
  @include mx.flex(flex, column);
  @include vh-full;

  // 스크롤 잠금
  &.is-locked {
    @include mx.position(fixed, 0, 0, 0, 0);
    overflow: hidden;
    touch-action: none;
  }

  // 바텀바 타입별 여백 자동 생성
  // ⚠️ 바텀바 추가 시 $mo-bottom-bar 맵에 키 추가하면 자동 반영
  // ⚠️ 클래스 네이밍: bottom-{타입} (예: bottom-tab-bar, bottom-action-bar)
  @each $type, $height in var.$mo-bottom-bar {
    &:has(.bottom-#{$type}) {
      .vm-content-wrap {
        @include bottom-bar-spacing(padding-bottom, $height);
      }
    }
  }
}

// --- 콘텐츠 래퍼 (header + main + footer) ---
// ⚠️ overflow: hidden 금지 — sticky 컨텍스트가 깨짐
.vm-content-wrap {
  flex: 1 1 auto;
  padding-top: var(--safe-top);
  background: map.get(color.$layout-surf, 'sunken');

  @include mx.flex(flex, column);
}

// --- 헤더 ---
.vm-header {
  flex-shrink: 0;
}

// --- 메인 ---
.vm-main {
  flex: 1 1 auto;
  min-width: 0;
  min-height: 0;
}

// --- 푸터 ---
.vm-footer {
  flex-shrink: 0;
}

// --- 하단 고정 그룹 ---
.vm-bottom-bar {
  @include mx.position(fixed, $right: 0, $bottom: 0, $left: 0);
  z-index: map.get(var.$mo-zindex, 'bottom-bar');
}
