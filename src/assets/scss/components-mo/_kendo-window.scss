// -----------------------------------------------------------------------------
// components-mo/_kendo-window.scss
// - ëª¨ë°”ì¼ Kendo Window / ë ˆì´ì–´ ê³µí†µ ìŠ¤íƒ€ì¼
// - ìƒíƒœ í´ë˜ìŠ¤: is-open(display on) / is-active(visible on) / is-closing(leave)
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

/* ê³µí†µ ë¯¹ìŠ¤ì¸ */

@mixin layer-hidden {
  display: none;
  pointer-events: none;
  visibility: hidden;
  opacity: 0;
}

@mixin layer-visible {
  pointer-events: auto;
  visibility: visible;
  opacity: 1;
}

@mixin layer-transition($delay: 0.35s) {
  transition:
    transform $delay ease,
    opacity $delay ease,
    visibility 0s $delay;
}

@mixin layer-transition-active {
  transition:
    transform 0.35s ease,
    opacity 0.35s ease,
    visibility 0s 0s;
}

/* ë”¤ ë ˆì´ì–´ */

[data-modal-dim] {
  @include layer-hidden;
  @include mx.position(absolute, 0, 0, 0, 0);
  z-index: var.$zindex-modal-dim;
  background-color: color.$color-dim;
  transition:
    opacity 0.35s ease,
    visibility 0s 0.35s;

  &.is-open {
    display: block;
  }

  &.is-open.is-active {
    @include layer-visible;
    transition:
      opacity 0.35s ease,
      visibility 0s 0s;
  }

  &.is-open.is-closing {
    @include layer-hidden;
    transition:
      opacity 0.35s ease,
      visibility 0s 0.35s;
  }
}

/* ëª¨ë‹¬ ë°•ìŠ¤ (ê³µí†µ) */

[data-modal-box] {
  @include layer-hidden;
  @include layer-transition;

  &.is-open {
    display: block;
  }

  &.is-open.is-active {
    @include layer-visible;
    @include layer-transition-active;
  }

  &.is-open.is-closing {
    @include layer-hidden;
    @include layer-transition;
  }
}

/* íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ */

// ëª¨ë‹¬
[data-modal-box][data-modal-type='modal'] {
  @include mx.position(fixed, 0, 0, 0, 0);
  z-index: var.$zindex-modal;
  transform: translateY(8px) scale(0.98);

  &.is-open.is-active {
    transform: translateY(0) scale(1);
  }

  &.is-open.is-closing {
    transform: translateY(8px) scale(0.98);
  }
}

// ë°”í…€ì‹œíŠ¸
[data-modal-box][data-modal-type='bottom'] {
  @include mx.position(fixed, 0, 0, 0, 0);
  z-index: var.$zindex-modal;
  transform: translateY(16px);

  &.is-open.is-active {
    transform: translateY(0);
  }

  &.is-open.is-closing {
    transform: translateY(16px);
  }
}

// ìŠ¬ë¼ì´ë“œ (ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ)
[data-modal-box][data-modal-type='slide-right'] {
  [class$='-panel'] {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    transition:
      transform 0.4s cubic-bezier(0.22, 1, 0.36, 1),
      opacity 0.3s ease,
      visibility 0s 0.3s;
    transform: translateX(100%);
    transform-origin: right center;
  }

  &.is-open.is-active {
    [class$='-dim'] {
      transition: none;
      transform: none;
    }

    [class$='-panel'] {
      transition:
        transform 0.4s cubic-bezier(0.22, 1, 0.36, 1),
        opacity 0.3s ease,
        visibility 0s 0s;
      transform: translateX(0);
    }
  }

  &.is-open.is-closing {
    [class$='-panel'] {
      transform: translateX(100%);
    }
  }
}

/* ì ‘ê·¼ì„± */

@media (prefers-reduced-motion: reduce) {
  [data-modal-box],
  [data-modal-dim] {
    transition: none;
  }
}

/* =============================================================
  ğŸš« DO NOT MODIFY ABOVE THIS LINE
  ìœ„ ìŠ¤íƒ€ì¼ì€ ì „ì²´ ë ˆì´ì–´ ì‹œìŠ¤í…œ ê³µí†µ ë² ì´ìŠ¤ì…ë‹ˆë‹¤.
  ê°œë³„ ë ˆì´ì–´ ìŠ¤íƒ€ì¼ì€ ì´ ì˜ì—­ ì•„ë˜ì—ì„œë§Œ ì‘ì„±í•˜ì„¸ìš”.
============================================================= */

/* ê°œë³„ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì˜ì—­ */

.vm-modal {
  &-inner {
    @include mx.flex(flex, column, flex-start, flex-start);
    width: 100%;
    max-height: calc(var(--vh, 1vh) * 95);

    > div[class*='vm-modal-'] {
      width: 100%;
    }
  }

  [class*='vm-modal-'][class*='-header'] {
    flex-shrink: 0;
  }

  // header
  &-header {
    @include mx.flex(flex, row, space-between, flex-start);
    position: relative;
    padding: var.$mo-section-gap var.$mo-gutter;
    background: color.$color-white;
    box-shadow: inset 0 -1px 0 0 map.get(color.$layout-border, 'quaternary');

    &-content {
      flex-grow: 1;
      min-width: 0;
      max-width: fit-content;
      overflow: hidden;
    }
  }

  &-title,
  &-subtitle {
    @include mx.ellipsis-single;
    width: 100%;
  }

  &-title {
    @include typo.typography('h4b', $color: map.get(color.$text-colors, 'primary'));
  }

  &-subtitle {
    @include typo.typography('b3r', $color: map.get(color.$text-colors, 'tertiary'));
    margin-top: map.get(var.$unit, 4);
    word-break: keep-all;
  }

  &-infotitle {
    @include typo.typography('b3r', $color: map.get(color.$text-status, 'brand-sub'));
    margin-top: map.get(var.$unit, 4);
  }

  &-close {
    @include button.btn-reset;
    @include icon.ic-size(fn.rem(28));
    flex-shrink: 0;
  }

  // ì»¨í…ì¸ 
  &-content {
    flex: 1 1 auto;
    min-width: 0;
    padding: map.get(var.$unit, 4) map.get(var.$unit, 16);
    overflow: hidden auto;
    background: color.$color-white;

    &.no-footer {
      padding-bottom: map.get(var.$unit, 24);
    }
  }

  // footer
  &-footer {
    padding: map.get(var.$unit, 24) map.get(var.$unit, 16);
    background: color.$color-white;
  }

  &-btn {
    @include button.btn-reset;
    @include mx.flex(flex, row, center, center);
    height: map.get(var.$unit, 52);
    padding: map.get(var.$unit, 12);
    border-radius: map.get(var.$radius, 'md');

    &-primary {
      background: map.get(color.$button-fill-primary, 'fill-surf-primary-default');
    }

    &-secondary {
      background: map.get(color.$button-fill-secondary, 'fill-surf-secondary-default');
    }

    .text {
      @include typo.typography('b2b', $color: map.get(color.$button-fill-primary, 'fill-on_surf-primary-default'));
    }
  }

  &-buttons {
    @include mx.flex(flex, row, center, center);
    gap: map.get(var.$unit, 8);

    &.is-single {
      .vm-modal-btn {
        flex: 1 1 auto;
        min-width: 0;
      }
    }

    &.is-double {
      .vm-modal-btn-secondary {
        flex: 2 1 0;
        min-width: 0;
      }

      .vm-modal-btn-primary {
        flex: 3 1 0;
        min-width: 0;
      }
    }
  }

  &:not(:has(.vm-modal-footer)) {
    .vm-modal-content {
      padding-bottom: map.get(var.$unit, 24);
    }
  }
}

/* =============================================================
  Kendo UI Window (Mobile)
  - vm-scope í•˜ìœ„ì—ì„œë§Œ ì ìš© (ìš´ì˜ ì‚¬ì´íŠ¸ ë¯¸ì˜í–¥)
  - ê¸°ë³¸: í™”ë©´ ì¤‘ì•™ ëª¨ë‹¬
  - is-bottomsheet: í•˜ë‹¨ ê³ ì • ë°”í…€ì‹œíŠ¸ (ìŠ¬ë¼ì´ë“œ ì—…)
  - is-slideright: ì˜¤ë¥¸ìª½ì—ì„œ ìŠ¬ë¼ì´ë“œ ì¸ (í’€ìŠ¤í¬ë¦°)
============================================================= */

@keyframes vm-slide-up {
  from {
    transform: translateY(100%);
  }

  to {
    transform: translateY(0);
  }
}

@keyframes vm-slide-in-right {
  from {
    transform: translateX(100%);
  }

  to {
    transform: translateX(0);
  }
}

@keyframes vm-slide-out-right {
  from {
    transform: translateX(0);
  }

  to {
    transform: translateX(100%);
  }
}

.vm-scope {
  // ê¸°ë³¸ ëª¨ë‹¬ â€” í™”ë©´ ì¤‘ì•™
  .k-window:has(.vm-modal-header) {
    overflow: hidden;
    border-radius: map.get(var.$radius, 'lg');

    .k-window-titlebar {
      display: none;
    }

    .k-window-content {
      min-height: 0;
      max-height: calc(var(--vh, 1vh) * 95);
      padding: 0 !important;
      overflow: visible;
    }
  }

  // ë°”í…€ì‹œíŠ¸ â€” í•˜ë‹¨ ê³ ì •
  .k-window.is-bottomsheet:has(.vm-modal-header) {
    border-radius: map.get(var.$radius, 'lg') map.get(var.$radius, 'lg') 0 0;

    &.is-opening {
      animation: vm-slide-up 0.35s ease forwards;
    }
  }

  // ìŠ¬ë¼ì´ë“œ ë¼ì´íŠ¸ â€” í’€ìŠ¤í¬ë¦° (ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½)
  .k-window.is-slideright:has(.vm-modal-header) {
    padding-bottom: calc(#{map.get(var.$mo-bottom-bar, 'tab-bar')} + var(--safe-bottom));
    overflow: hidden;
    border-radius: 0;

    .vm-modal {
      &-header {
        flex-shrink: 0;
        align-items: center;
        height: fn.rem(48);
        padding: 0 var.$mo-gutter;
      }

      &-inner {
        max-height: 100vh;
        max-height: 100dvh;
      }
    }

    .k-window-content {
      max-height: 100%;
    }

    &.is-opening {
      animation: vm-slide-in-right 0.35s ease forwards;
    }

    &.is-closing {
      animation: vm-slide-out-right 0.3s ease forwards;
    }
  }

  // ì¹´í…Œê³ ë¦¬ ë°”í…€ì‹œíŠ¸ â€” íƒ­ë°” í•˜ìœ„ í‘œì‹œ + ë…¸ì¹˜ ì•ˆì „ì˜ì—­
  .k-window:has(.modal-category-sheet) {
    z-index: map.get(var.$mo-zindex, 'bottom-bar') - 1 !important;

    /* stylelint-disable-next-line no-descending-specificity */
    .vm-modal-inner {
      max-height: calc(var(--vh, 1dvh) * 100 - #{map.get(var.$mo-bottom-bar, 'tab-bar')} - var(--safe-bottom));
    }

    .vm-modal-content {
      padding-bottom: calc(#{map.get(var.$mo-bottom-bar, 'tab-bar')} + var(--safe-bottom));
    }
  }

  .k-window:has(.modal-category-sheet) ~ .k-overlay {
    z-index: map.get(var.$mo-zindex, 'bottom-bar') - 2 !important;
  }

  // í•„í„° ìŠ¬ë¼ì´ë“œ â€” íƒ­ë°” í•˜ìœ„ í‘œì‹œ
  .k-window:has(.modal-filter-sheet) {
    z-index: map.get(var.$mo-zindex, 'bottom-bar') - 1 !important;

    .vm-modal {
      /* stylelint-disable-next-line no-descending-specificity */
      &-inner {
        max-height: calc(var(--vh, 1dvh) * 100 - #{map.get(var.$mo-bottom-bar, 'tab-bar')} - var(--safe-bottom));
      }

      &-content {
        padding: 0;
      }

      &-footer {
        padding-bottom: map.get(var.$unit, 56);
      }
    }
  }

  .k-window:has(.modal-filter-sheet) ~ .k-overlay {
    z-index: map.get(var.$mo-zindex, 'bottom-bar') - 2 !important;
  }
}
