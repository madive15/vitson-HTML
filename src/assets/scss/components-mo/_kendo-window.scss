// components-mo/_kendo-window.scss — Kendo Window 모바일 레이어

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

$mo-duration: 0.3s;
$mo-easing: cubic-bezier(0.33, 1, 0.68, 1);
$mo-sheet-easing: cubic-bezier(0.32, 0.72, 0, 1);
$mo-sheet-leave-ratio: 0.8;
$mo-alert-enter-ratio: 0.8;
$mo-alert-leave-ratio: 0.6;

.k-window:has(.vm-kwindow) {
  z-index: var.$zindex-modal;
  padding: map.get(var.$unit, 16) env(safe-area-inset-right, 0) map.get(var.$unit, 16) env(safe-area-inset-left, 0);
  border: 0;
  border-radius: 0;
  box-shadow: none;
  opacity: 0;
  transition:
    transform $mo-duration $mo-easing,
    opacity $mo-duration $mo-easing;
  transform: scale(0.96);

  @include mx.position(fixed, 0, 0, 0, 0);
  @include mx.flex(flex, column, center, center);

  .k-window-titlebar {
    display: none;
  }

  .k-window-content {
    padding: 0 !important;
    overflow: visible;
  }

  &.is-active {
    opacity: 1;
    transform: scale(1);
  }

  &.is-closing {
    opacity: 0;
    transform: scale(0.96);
  }
}

.k-window:has(.type-bottom-sheet) {
  justify-content: flex-end;
  padding: 0;
  opacity: 0;
  transition:
    transform $mo-duration $mo-sheet-easing,
    opacity $mo-duration * 0.6 ease;
  transform: translateY(100%);

  .k-window-content {
    height: 100%;
  }

  &.is-active {
    opacity: 1;
    transform: translateY(0);
  }

  &.is-closing {
    opacity: 0;
    transition:
      transform $mo-duration * $mo-sheet-leave-ratio $mo-sheet-easing,
      opacity $mo-duration * 0.5 ease;
    transform: translateY(100%);
  }
}

.type-bottom-sheet {
  display: flex;
  flex-direction: column;
  height: 85vh;
  max-height: 85vh;
  overflow: hidden;
  border-radius: map.get(var.$radius, 'lg') map.get(var.$radius, 'lg') 0 0;

  &::before {
    display: block;
    flex-shrink: 0;
    width: fn.rem(36);
    height: fn.rem(4);
    margin: map.get(var.$unit, 8) auto 0;
    content: '';
    background: map.get(color.$text-colors, 'disabled');
    border-radius: fn.rem(2);
  }

  .vm-kwindow-header {
    flex-shrink: 0;
  }

  .vm-kwindow-content {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
  }

  .vm-kwindow-content:has(.vm-category-sheet) {
    padding: 0;
  }

  .vm-kwindow-footer {
    flex-shrink: 0;
    padding-bottom: calc(#{map.get(var.$unit, 32)} + env(safe-area-inset-bottom, 0));
  }

  .vm-kwindow-content.no-footer {
    padding-bottom: calc(#{map.get(var.$unit, 32)} + env(safe-area-inset-bottom, 0));
  }
}

.k-window:has(.type-alert) {
  padding: map.get(var.$unit, 24);
  opacity: 0;
  transition:
    transform $mo-duration * $mo-alert-enter-ratio $mo-easing,
    opacity $mo-duration * $mo-alert-leave-ratio ease;
  transform: scale(0.92);

  &.is-active {
    opacity: 1;
    transform: scale(1);
  }

  &.is-closing {
    opacity: 0;
    transform: scale(0.92);
  }
}

.type-alert {
  max-width: fn.rem(320);
  overflow: hidden;
  border-radius: map.get(var.$radius, 'lg');

  .vm-kwindow-header {
    justify-content: center;
    padding: map.get(var.$unit, 32) map.get(var.$unit, 24) map.get(var.$unit, 16);

    &-text {
      text-align: center;
    }
  }

  .vm-kwindow-title {
    padding-right: 0;
  }

  .vm-kwindow-close {
    display: none;
  }

  .vm-kwindow-content {
    padding: map.get(var.$unit, 4) map.get(var.$unit, 24);
    text-align: center;
  }

  .vm-kwindow-footer {
    padding: map.get(var.$unit, 24);
  }
}

.vm-kwindow {
  @include mx.flex(flex, column, flex-start, stretch);
  width: 100%;
  background: color.$color-white;

  &:not([class*='type-']) {
    max-width: fn.rem(480);
    max-height: calc(var(--vh, 1vh) * 90);
    overflow: hidden;
    border-radius: map.get(var.$radius, 'lg');
  }

  &-header {
    @include mx.flex(flex, row, space-between, flex-start);
    position: relative;
    flex-shrink: 0;
    padding: map.get(var.$unit, 20) map.get(var.$unit, 20) map.get(var.$unit, 16);
    background: color.$color-white;

    &-text {
      flex-grow: 1;
      min-width: 0;
      overflow: hidden;
    }
  }

  &-title {
    @include mx.ellipsis-single;
    @include typo.typography('h4b', $color: map.get(color.$text-colors, 'primary'));
    padding-right: map.get(var.$unit, 32);
  }

  &-subtitle {
    @include mx.ellipsis-single;
    @include typo.typography('b3r', $color: map.get(color.$text-colors, 'tertiary'));
    margin-top: map.get(var.$unit, 4);
  }

  &-infotitle {
    @include typo.typography('b3r', $color: map.get(color.$text-status, 'brand-sub'));
    margin-top: map.get(var.$unit, 4);
  }

  &-close {
    @include button.btn-reset;
    @include icon.ic-size(map.get(var.$unit, 28));
    @include mx.position(absolute, map.get(var.$unit, 20), map.get(var.$unit, 20), auto, auto);
  }

  &-content {
    flex: 1 1 auto;
    min-height: 0;
    padding: map.get(var.$unit, 4) map.get(var.$unit, 20);
    overflow: hidden auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    background: color.$color-white;

    &.has-scroll {
      padding-right: map.get(var.$unit, 16);
    }

    &.no-footer {
      padding-bottom: map.get(var.$unit, 20);
    }
  }

  &-footer {
    flex-shrink: 0;
    padding: map.get(var.$unit, 20);
    background: color.$color-white;
  }

  &-btn {
    @include button.btn-reset;
    @include mx.flex(flex, row, center, center);
    height: map.get(var.$unit, 52);
    padding: map.get(var.$unit, 14) map.get(var.$unit, 12);
    border-radius: map.get(var.$radius, 'md');

    &.is-primary {
      background: map.get(color.$button-fill-primary, 'fill-surf-primary-default');
    }

    &.is-secondary {
      background: map.get(color.$button-fill-secondary, 'fill-surf-secondary-default');
    }

    .text {
      @include typo.typography('h4b', $color: map.get(color.$button-fill-primary, 'fill-on_surf-primary-default'));
    }
  }

  &-buttons {
    @include mx.flex(flex, row, center, center);
    gap: map.get(var.$unit, 8);

    &.is-single {
      .vm-kwindow-btn {
        flex: 1 1 auto;
        min-width: 0;
      }
    }

    &.is-double {
      .vm-kwindow-btn.is-secondary {
        flex: 2 1 0;
        min-width: 0;
      }

      .vm-kwindow-btn.is-primary {
        flex: 3 1 0;
        min-width: 0;
      }
    }
  }
}

@media (prefers-reduced-motion: reduce) {
  .k-window:has(.vm-kwindow) {
    transition: none;
  }
}

.vm-bottom-sheet {
  position: fixed !important;
  inset: auto 0 0 !important;
  width: 100% !important;
  height: 85vh;
  padding: 0 !important;
  overflow: hidden;
  border: 0 !important;
  border-radius: 12px 12px 0 0;
  box-shadow: 0 -4px 20px rgb(0 0 0 / 10%);

  .k-window-titlebar {
    display: none;
  }

  .k-window-content {
    height: 100%;
    padding: 0 !important;
    overflow: hidden;
  }
}
