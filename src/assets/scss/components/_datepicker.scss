// -----------------------------------------------------------------------------
// components/_datepicker.scss
// - 데이트피커 컴포넌트 전용 스타일
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

$vits-datepicker-single-sizes: (
  size-s: (
    typo: 'b4r',
    min-h: 28
  ),
  size-m: (
    typo: 'b3r',
    min-h: 32
  ),
  size-l: (
    typo: 'b3r',
    min-h: 36
  )
);

@mixin vits-datepicker-single-base {
  @include mx.flex(inline-flex, $align: center, $justify: space-between);
  padding: 0 map.get(var.$unit, 8) 0 map.get(var.$unit, 12);
  font-size: inherit;
  background: map.get(color.$layout-surf, 'base');
  border: 1px solid map.get(color.$layout-border, 'tertiary');
  border-radius: map.get(var.$radius, 'sm');

  .k-input-inner {
    text-indent: 0;
  }
}

@mixin vits-datepicker-single-input {
  @include mx.flex(inline-flex, $align: center);
  height: 100%;
  min-height: 100%;
  padding: 0;
  color: map.get(color.$text-colors, 'secondary');
  border: 0;

  &::placeholder {
    color: map.get(color.$text-colors, 'muted');
  }
}

@mixin vits-datepicker-single-size($typo, $min-h) {
  @include typo.typography($typo);
  min-height: fn.rem($min-h);
}

/* Kendo Range Picker */
@mixin range-grad($type) {
  @if $type == 'start' {
    background: #fff;
    background: linear-gradient(
      90deg,
      rgb(255 255 255 / 100%) 50%,
      rgb(254 225 226 / 100%) 50%,
      rgb(254 225 226 / 100%) 50%
    );
  }

  @if $type == 'end' {
    background: #fff;
    background: linear-gradient(
      270deg,
      rgb(255 255 255 / 100%) 50%,
      rgb(254 225 226 / 100%) 50%,
      rgb(254 225 226 / 100%) 50%
    );
  }
}

.vits-kendo-range-picker {
  position: relative;
  width: 100%;

  .picker {
    &-input {
      @include mx.flex;
      @include mx.border('all', $color: map.get(color.$layout-border, 'tertiary'));
      width: 100%;
      height: map.get(var.$unit, 32);
      overflow: hidden;
      background: color.$color-white;
      border-radius: map.get(var.$radius, 'sm');
    }

    &-display {
      @include typo.typography('b3r', $color: map.get(color.$text-colors, 'secondary'));
      padding: 0 0 0 map.get(var.$unit, 12);
      margin: 0;
      appearance: none;
      cursor: pointer;
      background: transparent;
      border: 0;
      outline: 0;

      &::placeholder {
        color: map.get(color.$text-colors, 'muted');
      }
    }

    &-button {
      @include mx.flex(flex, row, flex-start, center);
      width: fn.rem(30);

      .icon {
        @include icon.ic-size(fn.rem(22));
        color: map.get(color.$icon-neutral, 'primary');
      }
    }

    &-popup {
      @include mx.position(absolute, calc(100% + 4px), $left: 0);
      @include mx.border('all', $color: map.get(color.$layout-border, 'primary'));
      z-index: var.$zindex-range-picker-popup;
      display: none;
      width: fn.rem(360);
      max-width: fn.rem(360);
      padding: map.get(var.$unit, 20);
      background: color.$color-white;
      border-radius: map.get(var.$radius, 'md');

      .k-calendar,
      .k-calendar-view,
      .k-calendar-table,
      .k-calendar-tbody,
      .k-content {
        transition: none !important;
        animation: none !important;
      }

      // 슬라이드 효과 제거
      .k-calendar-view {
        min-height: fn.rem(154);
        overflow: hidden;

        &.k-calendar-monthview {
          transition: none !important;
        }
      }

      .k-calendar {
        width: 100%;
        padding: 0;
        margin: 0;
        background: transparent;
        border: 0;

        *,
        *::before,
        *::after {
          transition: none !important;
          animation: none !important;
        }

        .k-button,
        .k-button-flat,
        .k-button-flat-base,
        .k-calendar-nav-fast {
          background: none !important;
          border: none !important;
          outline: none !important;
          box-shadow: none !important;
          -webkit-tap-highlight-color: transparent !important;

          &::before,
          &::after {
            display: none !important;
          }

          &:focus,
          &:active,
          &:hover,
          &:focus-visible,
          &.k-focus,
          &.k-active,
          &.k-selected {
            background: none !important;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;

            &::after,
            &::before {
              display: none;
            }
          }
        }

        /* stylelint-disable-next-line no-descending-specificity */
        .k-calendar-nav-fast {
          display: block;
          flex-basis: fn.rem(150) !important;
          width: fn.rem(150) !important;
        }

        .k-header {
          @include mx.flex(flex, row, center, center);
          gap: map.get(var.$unit, 16);
          padding: 0;
          background: transparent;
          border: 0;
          box-shadow: none;

          .k-button.k-rounded-md .k-button-text {
            @include typo.typography('h3b');

            .nav-dot {
              padding: 0 map.get(var.$unit, 12);
            }
          }

          .k-calendar-nav-fast {
            flex: 0;
            padding: 0;
          }

          .k-calendar-nav-prev,
          .k-calendar-nav-next {
            display: block;
            width: map.get(var.$unit, 32);
            height: map.get(var.$unit, 32);
            background: #fff no-repeat center / contain !important;

            .k-icon {
              display: none;
            }
          }

          .k-calendar-nav-prev {
            background-image: url('/public/resources/img/mro/renewal/ic/ic-arrow-left.svg') !important;
          }

          .k-calendar-nav-next {
            background-image: url('/public/resources/img/mro/renewal/ic/ic-arrow-right.svg') !important;
          }
        }

        .k-calendar-view {
          width: 100%;
          padding: 0;

          .k-calendar-table {
            width: 100%;

            .k-calendar-thead {
              .k-calendar-th {
                @include typo.typography('b3r');
                padding: map.get(var.$unit, 20) 0;
              }
            }
          }

          &.k-calendar-monthview {
            // 2026-02-09 추가 - other-month 셀 숨김 (range picker 전용)
            td.k-other-month {
              height: 0;
              padding: 0;
              font-size: 0;
              line-height: 0;
              pointer-events: none;
              visibility: hidden;
            }

            // 2026-02-09 추가 - JS가 부여하는 빈 행 축소 클래스
            tbody tr.is-empty-row {
              display: none;
            }

            td {
              &.k-hover,
              &.k-hover:hover,
              &:hover {
                // pointer-events: none;
                background: transparent;
              }

              // td hover 시 내부 k-link에 스타일 적용 (깜박임 방지)
              &:hover .k-link {
                background: map.get(color.$layout-surf, 'sunken');
              }

              .k-link {
                @include mx.flex(flex, row, center, center);
                @include typo.typography('b3r', $color: map.get(color.$text-colors, 'secondary'));
                width: fn.rem(32);
                height: fn.rem(32);
                padding: 0;
                margin: 0 auto;
                line-height: 32px;

                // pointer-events: auto;
                border-radius: 50%;
                box-shadow: none;

                // &:hover {
                //   background: map.get(color.$layout-surf, 'sunken');
                // }
              }

              &.k-today .k-link {
                font-weight: 600;
                color: map.get(color.$text-colors, 'primary');
              }

              &.k-range-start {
                background: transparent;
              }

              &.k-range-end {
                background: transparent;
              }

              &.k-selected .k-link,
              &.k-range-start .k-link,
              &.k-range-end .k-link {
                color: color.$color-white;
                background: map.get(color.$brand-colors, 'hover');

                // &:hover {
                //   color: color.$color-white;
                //   background: map.get(color.$brand-colors, 'hover') !important;
                // }
              }

              // 선택 상태 hover (td 기준으로 통일)
              &.k-selected:hover .k-link,
              &.k-range-start:hover .k-link,
              &.k-range-end:hover .k-link {
                color: color.$color-white;
                background: map.get(color.$brand-colors, 'hover') !important;
              }

              &.k-range-mid {
                &,
                &:hover,
                &.k-hover {
                  background: #fee1e2 !important;
                }

                /* stylelint-disable-next-line no-descending-specificity */
                .k-link {
                  color: map.get(color.$text-status, 'brand');
                }

                // &:hover .k-link,
                // .k-link:hover {
                //   color: map.get(color.$text-status, 'brand') !important;
                //   background: transparent !important;
                //   box-shadow: none !important;
                // }

                // td hover 기준으로 통일
                &:hover .k-link {
                  color: map.get(color.$text-status, 'brand') !important;
                  background: transparent !important;
                  box-shadow: none !important;
                }
              }

              // max 이후 날짜 비활성화 (JS가 k-state-disabled 부여)
              &.k-state-disabled {
                pointer-events: none;
                background: transparent !important;

                .k-link {
                  color: map.get(color.$text-colors, 'muted');
                  cursor: default;
                  background: none !important;
                }
              }
            }
          }

          &.k-calendar-yearview,
          &.k-calendar-decadeview,
          &.k-calendar-centuryview {
            @include mx.flex(flex, column, flex-start, flex-start);
            box-sizing: border-box;
            padding-top: map.get(var.$unit, 20);

            /* stylelint-disable-next-line no-descending-specificity */
            .k-link {
              padding: 0 map.get(var.$unit, 16);
            }

            .k-calendar-table .k-range-start,
            .k-calendar-table .k-range-mid,
            .k-calendar-table .k-range-end {
              background: color.$color-white;
              border-radius: 0;

              /* stylelint-disable-next-line no-descending-specificity */
              .k-link {
                background: map.get(color.$layout-border, 'quinary');
                border-radius: map.get(var.$unit, 4);

                &:hover,
                &:focus,
                &:active {
                  color: #3d3d3d;
                }
              }
            }
          }
        }

        // has-range 있을 때만 gradient
        &.has-range .k-calendar-monthview td {
          &.k-range-start {
            @include range-grad('start');

            &:hover {
              @include range-grad('start');
            }
          }

          &.k-range-end {
            @include range-grad('end');

            &:hover {
              @include range-grad('end');
            }
          }
        }
      }

      &.is-open {
        display: block;
      }
    }
  }

  &.size-sm {
    .picker-input {
      height: fn.rem(28);
    }

    .picker-display {
      font-size: fn.rem(12);
    }
  }

  &.size-lg {
    .picker-input {
      height: fn.rem(36);
    }
  }

  &.is-selected {
    .picker-input {
      border-color: map.get(color.$layout-border, 'primary');
    }
  }
}

/* ===single datepicker=== */
/* stylelint-disable no-descending-specificity */
.vits-datepicker-single {
  &:is(.size-s, .size-m, .size-l) {
    @include vits-datepicker-single-base;

    .datepicker-single {
      @include vits-datepicker-single-input;
    }
  }

  @each $size, $opt in $vits-datepicker-single-sizes {
    &.#{$size} {
      .datepicker-single {
        @include vits-datepicker-single-size(map.get($opt, typo), map.get($opt, min-h));
      }
    }
  }

  // 달력모양 이미지 제어
  [aria-label='select'] {
    width: auto;

    &:hover {
      background-color: transparent;
    }
  }

  .k-svg-i-calendar {
    @include mx.background('ic/ic-calendar.svg');
    width: fn.rem(22);
    height: fn.rem(22);

    svg {
      display: none;
    }
  }

  /* 달력 컨테이너 */
  $calendar-cell-size: fn.rem(32);
  $calendar-cell-hover-bg: map.get(color.$layout-surf, 'sunken');
  $calendar-other-month-color: map.get(color.$text-colors, 'muted');

  /* ===== Calendar Shell ===== */
  &.k-calendar,
  &.k-calendar-container .k-calendar {
    padding: map.get(var.$unit, 20);
    margin-left: (map.get(var.$unit, 12) * -1);
    overflow: hidden;
    border: 1px solid map.get(color.$layout-border, 'primary');
    border-radius: map.get(var.$radius, 'md');
  }

  /* ===== Header ===== */
  .k-header.k-hstack {
    width: fn.rem(214);
    padding: 0;
    margin: 0 auto;
    background: none;
    border: 0;
    box-shadow: revert-layer;

    .k-button.k-rounded-md {
      padding: 0;

      .k-button-text {
        @include typo.typography('h3b', $color: map.get(color.$text-status, 'primary'));

        .nav-dot {
          padding: 0 map.get(var.$unit, 12);
        }
      }
    }

    /* ===== Header Buttons ===== */
    .k-calendar-nav-prev,
    .k-calendar-nav-next {
      @include icon.ic-size(map.get(var.$unit, 32));

      .k-button-icon {
        @include icon.ic-size(map.get(var.$unit, 32));

        svg {
          display: none;
        }
      }
    }

    .k-calendar-nav-prev {
      .k-button-icon {
        @include mx.background('ic/ic-arrow-left.svg');
      }
    }

    .k-calendar-nav-next {
      .k-button-icon {
        @include mx.background('ic/ic-arrow-right.svg');
      }
    }
  }

  /* ===== View / Table ===== */
  .k-calendar-view.k-calendar-monthview {
    width: 100%;
    padding: 0;

    .k-calendar-table {
      width: fn.rem(320);
      margin: 0;
      transform: none !important;

      /* 02.21 (추가 수정) 모바일 넓이 */
      @media screen and (width <= 768px) {
        width: auto;
      }
    }

    /* ===== Table Head ===== */
    .k-calendar-th {
      height: 18px;
      min-height: 18px;
      padding: 0;
      font-size: 14px;
      font-weight: 400;
      line-height: fn.rem(58);
      color: map.get(color.$text-colors, 'primary');
      white-space: nowrap;
    }

    /* ===== Table Body ===== */
    .k-calendar-tbody {
      .k-calendar-td {
        width: auto;
        padding: 0;

        .k-link {
          width: $calendar-cell-size;
          height: $calendar-cell-size;
          padding: 0;
          margin: 0 auto;
          font-weight: 400;
          background-color: transparent;
          border-radius: 50%;
          box-shadow: none;
        }

        // 지난 날짜
        &.date-past {
          pointer-events: none;
          cursor: none;

          .k-link {
            color: map.get(color.$text-colors, 'muted');
          }
        }

        // 날짜 셀 제어
        &:hover {
          width: auto;
          padding: 0;
          color: map.get(color.$text-colors, 'primary');
          background-color: transparent;
          border-radius: 50%;

          .k-link {
            background-color: $calendar-cell-hover-bg;
          }
        }

        &.k-selected {
          .k-link {
            color: #fff;
            background-color: map.get(color.$text-status, 'brand');
            box-shadow: none;
          }
        }

        /* ===== Today / Focus ===== */
        &.k-today {
          width: $calendar-cell-size;
          height: $calendar-cell-size;
          color: map.get(color.$text-colors, 'primary');
          border: 0;

          .k-link {
            font-weight: 700 !important;
            color: map.get(color.$text-colors, 'primary');
          }

          &.k-focus {
            .k-link {
              border: 0;
              box-shadow: none;
            }
          }

          &.k-selected {
            color: #fff;

            .k-link {
              color: #fff;
            }
          }
        }
      }
    }
  }

  .k-calendar-view.k-calendar-yearview,
  .k-calendar-view.k-calendar-decadeview,
  .k-calendar-view.k-calendar-centuryview {
    display: flex;
    padding: fn.rem(20) 0;

    .k-calendar-table {
      width: 100%;

      .k-calendar-td {
        /* empty */
        &.k-empty {
          display: none !important;
        }
      }
    }
  }

  .k-calendar-centuryview .k-link {
    padding-left: fn.rem(16);
  }

  /* ===== Other Month (원본 유지) ===== */
  .k-other-month {
    .k-link {
      color: $calendar-other-month-color;
    }

    &.k-weekend {
      pointer-events: none;
      cursor: none;
    }
  }

  &.is-selected {
    border-color: map.get(color.$layout-border, 'primary');
  }
}

/* ===== 02.21 (추가 수정) 모바일 영향 ===== */
.vits-datepicker-single-container {
  .k-calendar-container.k-popup {
    background-color: transparent;
    border: 0;
  }
}
/* stylelint-enable no-descending-specificity */
