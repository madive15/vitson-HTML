// -----------------------------------------------------------------------------
// components/_select.scss
// - 옵션 선택을 위한 셀렉트 UI 공통 스타일 정의.
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

.vits-select {
  position: relative;
  display: inline-block;
  max-width: 100vw;

  &-value {
    @include typo.typography('b3r', map.get(color.$text-colors, 'tertiary'));
    @include mx.ellipsis-single;
    min-width: 0;
    max-width: 100vw;
  }

  &-icon {
    @include icon.ic-size(map.get(var.$unit, 20));
    flex-shrink: 0;
    color: map.get(color.$icon-neutral, 'tertiary');
    transition: transform 0.3s;
    will-change: transform;
  }

  &-trigger {
    @include button.btn-reset;
    @include mx.flex(flex, row, space-between, center);
    @include mx.ellipsis-single;
    gap: map.get(var.$unit, 8);
    width: fit-content;
    min-width: 0;
    max-width: 100vw;
    height: map.get(var.$unit, 32);
    padding: 0 map.get(var.$unit, 8);
    text-align: left;
    background: color.$color-white;
    border-radius: map.get(var.$radius, 'sm');
    box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'tertiary');
    transition: box-shadow 0.3s;

    &[aria-expanded='true'] {
      box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'primary');

      .vits-select-icon {
        transform: rotate(180deg);
      }
    }

    @include mx.common-mouse-event {
      box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'primary');
    }
  }

  &-list {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    z-index: var.$zindex-select-option;
    display: block;
    width: max-content;
    max-width: 100vw;

    /* 닫힘 상태: 스크롤 영역에 절대 영향을 주지 않게 "높이 0"으로 고정 */
    max-height: 0; /* 열릴 때 JS 인라인 max-height로 덮어씀 */
    padding: 0;
    overflow: hidden;
    pointer-events: none;
    visibility: hidden;
    background: color.$color-white;
    border-radius: 6px;
    box-shadow: none;
    opacity: 0;
    transition:
      opacity 0.2s ease,
      transform 0.2s ease,
      max-height 0s linear 0.2s,
      visibility 0s linear 0.2s;
    transform: translateY(-4px);
    will-change: opacity, transform;
  }

  &-open .vits-select-list {
    // 열림 상태에서만 실제 패딩/그림자 적용
    padding: map.get(var.$unit, 8) 1px;
    overflow-y: auto;
    pointer-events: auto;
    visibility: visible;
    box-shadow: inset 0 0 0 1px color.$color-black;
    opacity: 1;
    transition:
      opacity 0.2s ease,
      transform 0.2s ease,
      max-height 0s,
      visibility 0s;
    transform: translateY(0);
  }

  &.vits-select-dropup {
    .vits-select-list {
      top: auto;
      bottom: calc(100% + 4px);
      transform: translateY(4px);
    }

    &.vits-select-open .vits-select-list {
      transform: translateY(0);
    }
  }

  &-option {
    @include mx.flex(flex, row, flex-start, center);
    @include typo.typography('b3r', $color: map.get(color.$neutral-colors, '1'));
    min-height: map.get(var.$unit, 32);
    padding: 0 map.get(var.$unit, 16);
    cursor: pointer;

    @include mx.common-mouse-event {
      font-weight: 600;
      background: map.get(color.$layout-surf, 'sunken');
    }
  }

  &-selected {
    font-weight: 600;
    background: color.$color-white;
  }

  &-option-disabled {
    pointer-events: none;
    opacity: 0.4;
  }

  &-disabled {
    pointer-events: none;

    .vits-select {
      &-trigger {
        background: map.get(color.$layout-surf, 'raised');
        box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'quaternary');
      }

      &-value {
        color: map.get(color.$text-colors, 'muted');
      }

      /* stylelint-disable-next-line no-descending-specificity */
      &-icon {
        color: map.get(color.$icon-neutral, 'disabled');
      }
    }
  }

  &.size-s {
    .vits-select {
      &-trigger {
        height: fn.rem(28);
      }

      &-option {
        min-height: fn.rem(28);
        font-size: fn.rem(12);
      }

      &-value {
        font-size: fn.rem(12);
      }
    }
  }

  &.size-l {
    .vits-select {
      &-trigger {
        height: fn.rem(44);
      }

      &-option {
        min-height: fn.rem(44);
        font-size: fn.rem(16);
      }

      &-value {
        font-size: fn.rem(16);
      }
    }
  }

  &.is-selected:not(.type-ghost, .type-dark) {
    // 모바일 동일 컴포넌트 활용으로 우선수위로 important 적용
    .vits-select {
      &-value {
        color: map.get(color.$text-colors, 'default') !important;
      }

      &-icon {
        color: map.get(color.$icon-neutral, 'primary') !important;
      }

      &-trigger {
        box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'primary') !important;
      }
    }
  }
}

/* 예시, footer family site */
.vits-select.type-dark {
  width: 100%;

  .vits-select {
    /* stylelint-disable no-descending-specificity */
    &-trigger {
      justify-content: space-between;
      width: 100%;
      height: fn.rem(36);
      padding: 0 13px 0 map.get(var.$unit, 16);
      background: map.get(color.$gray-shades, '90');
      box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'secondary');
    }

    &-value {
      color: map.get(color.$text-colors, 'tertiary');
    }

    &-list {
      width: 100% !important;
      max-width: 100% !important;
      padding: 0;
      transition: none;
    }
    /* stylelint-enable no-descending-specificity */

    &-option {
      height: fn.rem(42);
      padding: 0 map.get(var.$unit, 16);
      color: map.get(color.$text-colors, 'muted');
      background: map.get(color.$gray-shades, '60');

      &.vits-select-selected {
        font-weight: 400;
        background: map.get(color.$layout-surf, 'sunken');
        background: map.get(color.$gray-shades, '70');
      }

      @include mx.common-mouse-event {
        font-weight: 400;
        background: map.get(color.$layout-surf, 'sunken');
        background: map.get(color.$gray-shades, '70');
      }
    }
  }

  &.vits-select-open:not(.vits-select-dropup) .vits-select-list {
    top: 100%;
  }

  &.vits-select-open.vits-select-dropup {
    .vits-select-trigger {
      background: map.get(color.$gray-shades, '60');
      border-top-left-radius: 0;
      border-top-right-radius: 0;

      .vits-select-value {
        color: map.get(color.$text-colors, 'muted');
      }

      .vits-select-icon {
        color: map.get(color.$icon-neutral, 'disabled');
      }
    }

    .vits-select-list {
      bottom: 100%;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0;
    }
  }
}

/* 예시, 목록 ??개씩 보기 */
.vits-select.type-ghost {
  min-width: fn.rem(114);
  height: map.get(var.$unit, 20);

  /* stylelint-disable no-descending-specificity */
  .vits-select-trigger {
    width: 100%;
    height: 100%;
    background: transparent;
    box-shadow: none;
  }

  &.color-secondary {
    .vits-select-value {
      color: map.get(color.$text-colors, 'tertiary');
    }
  }
  /* stylelint-enable no-descending-specificity */
}

/* portal 모드 list 스타일 */
.vits-select-list-portal {
  @include mx.border('all', $color: color.$color-black);

  // 추가 portal 전용
  position: fixed;
  z-index: 9999;
  padding: map.get(var.$unit, 8) 1px;
  overflow-y: auto;
  pointer-events: auto;
  visibility: visible;
  background: #fff; // 또는 기존 배경색 변수
  opacity: 1;

  // transition/animation 효과 제거 (중요!)
  transition: none !important;
  transform: translateY(0);
}
