// -----------------------------------------------------------------------------
// components/_button.scss
// - 공통 버튼 컴포넌트 스타일 정의
// -----------------------------------------------------------------------------

@use 'sass:map';
@use 'sass:meta';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;

/* 버튼 초기화 */
@mixin btn-reset {
  padding: 0;
  margin: 0;
  font: inherit;
  line-height: inherit;
  color: inherit;
  letter-spacing: inherit;
  appearance: none;
  cursor: pointer;
  background: transparent;
  border: 0;

  // iOS Safari 탭 하이라이트(필요 시)
  -webkit-tap-highlight-color: transparent;

  // 비활성 기본
  &:disabled {
    cursor: not-allowed;
  }
}

/* 상품 목록 - 재검색 칩버튼 좌우 화살표 */
@mixin btn-ico-circle(
  $w,
  $h: $w,
  $ic-w,
  $ic-h: $ic-w,
  $bg: map.get(color.$layout-surf, base),
  $border: 1px solid map.get(color.$layout-border, 'tertiary'),
  $color: map.get(color.$icon-neutral, 'primary'),
  $shadow: 0 4px 7px 0 rgb(0 0 0 / 4%)
) {
  @include btn-reset;
  width: $w;
  height: $h;
  background: $bg;
  border: $border;
  border-radius: 50%;

  .ic {
    width: $ic-w;
    height: $ic-h;
  }

  @if $shadow != 'none' {
    box-shadow: $shadow;
  }
}

/* -----------------------------------------------------------------------------
 * 기본 버튼 컴포넌트 (.vits-btn-*)
 * - Fill 타입: primary, secondary, tertiary ,primary-soft
 * - Outline 타입: outline-primary, outline-secondary, outline-tertiary
 * - 크기: xxl, xl, lg, md, sm, xs, xxs
 * --------------------------------------------------------------------------- */

// 버튼 기본 스타일
:is(
  .vits-btn-xxl,
  .vits-btn-xl,
  .vits-btn-lg-p,
  .vits-btn-lg,
  .vits-btn-md,
  .vits-btn-sm,
  .vits-btn-xs,
  .vits-btn-xxs
) {
  position: relative;
  gap: map.get(var.$unit, 8);
  padding: 0 map.get(var.$unit, 12);
  margin: 0;
  white-space: nowrap;
  transition:
    background-color 0.2s ease,
    border-color 0.2s ease,
    color 0.2s ease;
  -webkit-tap-highlight-color: transparent;

  @include mx.flex(flex, row, center, center);

  .icon {
    @include mx.flex(flex, row, center, center);
    flex-shrink: 0;
  }

  .text {
    @include mx.flex(flex, row, center, center);
    line-height: normal;
  }

  // 아이콘만 있는 경우
  &:not(.icon-left, .icon-right) {
    .icon {
      margin: 0;
    }
  }

  // .text가 없고 .icon만 있는 경우 padding 제거
  &:has(.icon):not(:has(.text)) {
    padding: 0;
  }

  &:disabled {
    pointer-events: none;
    cursor: default;
  }
}

// 버튼 크기 정의 (반복문)
$button-sizes: (
  'xxl': (
    'min-height': 64,
    'padding': 12,
    'typography': 'b1b',
    'icon-size': 32,
    'font-size': 20
  ),
  'xl': (
    'min-height': 52,
    'padding': 12,
    'typography': 'b2b',
    'icon-size': 24,
    'font-size': 16
  ),
  'lg-p': (
    'min-height': 44,
    'padding': 12,
    'typography': 'b2b',
    'icon-size': 24,
    'font-size': 16
  ),
  'lg': (
    'min-height': 40,
    'padding': 12,
    'typography': 'b2b',
    'icon-size': 24,
    'font-size': 16,
    'border-radius': 'sm'
  ),
  'md': (
    'min-height': 36,
    'padding': 12,
    'typography': 'b3b',
    'icon-size': 20,
    'font-size': 14,
    'border-radius': 'sm'
  ),
  'sm': (
    'min-height': 32,
    'padding': 12,
    'typography': 'b3b',
    'icon-size': 20,
    'font-size': 14,
    'border-radius': 'sm'
  ),
  'xs': (
    'min-height': 28,
    'padding': 12,
    'typography': 'b4r',
    'icon-size': 16,
    'font-size': 12,
    'border-radius': 'sm'
  ),
  'xxs': (
    'min-height': 24,
    'padding': 9,
    'border-radius': 6,
    'typography': 'b4r',
    'icon-size': 16,
    'font-size': 9
  )
);

@each $size, $config in $button-sizes {
  .vits-btn-#{$size} {
    min-height: fn.rem(map.get($config, 'min-height'));
    padding: 0 fn.rem(map.get($config, 'padding'));
    font-size: fn.rem(map.get($config, 'font-size'));

    @if map.has-key($config, 'border-radius') {
      $border-radius-value: map.get($config, 'border-radius');

      @if meta.type-of($border-radius-value) == 'string' {
        border-radius: map.get(var.$radius, $border-radius-value);
      }
      // stylelint-disable-next-line at-rule-empty-line-before
      @else {
        border-radius: fn.rem($border-radius-value);
      }
    }
    // stylelint-disable-next-line no-descending-specificity
    @else {
      border-radius: map.get(var.$radius, 'md');
    }

    @include typo.typography(map.get($config, 'typography'));

    .icon {
      @include icon.ic-size(fn.rem(map.get($config, 'icon-size')));

      .ic {
        width: 100%;
        height: 100%;
      }
    }
  }
}

// 버튼 색상 변수
$button-colors: (
  'primary': map.get(color.$button-fill-primary, 'fill-surf-primary-default'),
  'primary-soft': map.get(color.$button-fill-primary-soft, 'fill-surf-primary-soft-default'),
  'secondary': map.get(color.$gray-shades, '80'),
  'tertiary': map.get(color.$gray-shades, '60'),
  'disabled': map.get(color.$gray-shades, '40')
);

// Fill 타입 버튼 생성 (반복문)
$fill-button-types: (
  'primary': map.get($button-colors, 'primary'),
  'primary-soft': map.get($button-colors, 'primary-soft'),
  'secondary': map.get($button-colors, 'secondary'),
  'tertiary': map.get($button-colors, 'tertiary'),
  'disabled': map.get($button-colors, 'disabled')
);
$fill-button-hover-colors: (
  'primary': map.get(color.$red-shades, '90'),
  'primary-soft': map.get(color.$red-shades, '70'),
  'secondary': map.get(color.$gray-shades, '70'),
  'tertiary': map.get(color.$gray-shades, '50'),
  'disabled': map.get($button-colors, 'disabled')
);
$fill-button-disabled-colors: (
  'primary': map.get(color.$gray-shades, '20'),
  'primary-soft': map.get(color.$gray-shades, '20'),
  'secondary': map.get(color.$gray-shades, '20'),
  'tertiary': map.get(color.$gray-shades, '20'),
  'disabled': map.get(color.$gray-shades, '20')
);

@each $type, $color-value in $fill-button-types {
  .vits-btn-#{$type} {
    color: color.$color-white;
    background-color: $color-value;
    border-width: 0;

    .icon {
      color: color.$color-white;
    }

    &:hover:not(:disabled) {
      color: map.get(color.$icon-neutral, 'inverse');
      background-color: map.get($fill-button-hover-colors, $type);

      .icon {
        color: map.get(color.$icon-neutral, 'inverse');
      }
    }

    &:disabled {
      color: map.get(color.$icon-neutral, 'tertiary');
      background-color: map.get($fill-button-disabled-colors, $type);

      .icon {
        color: map.get(color.$icon-neutral, 'tertiary');
      }
    }
  }
}

// Outline 타입 버튼 생성 (반복문)
$outline-button-border-colors: (
  'primary': map.get(color.$red-shades, '80'),
  'secondary': map.get(color.$gray-shades, '80'),
  'tertiary': map.get(color.$gray-shades, '50')
);
$outline-button-hover-bg-colors: (
  'primary': map.get(color.$red-shades, '10'),
  'secondary': map.get(color.$gray-shades, '10'),
  'tertiary': map.get(color.$gray-shades, '10')
);
$outline-button-disabled-colors: (
  'primary': map.get(color.$red-shades, '40'),
  'secondary': map.get(color.$gray-shades, '40'),
  'tertiary': map.get(color.$gray-shades, '30')
);
$outline-button-disabled-bg-colors: (
  'primary': map.get(color.$gray-shades, '0'),
  'secondary': map.get(color.$gray-shades, '10'),
  'tertiary': map.get(color.$gray-shades, '10')
);

@each $type, $border-color in $outline-button-border-colors {
  .vits-btn-outline-#{$type} {
    color: $border-color;
    background-color: color.$color-white;
    border: 1px solid $border-color;

    .icon {
      color: $border-color;
    }

    &:hover:not(:disabled) {
      background-color: map.get($outline-button-hover-bg-colors, $type);
    }

    &:disabled {
      color: map.get($outline-button-disabled-colors, $type);
      background-color: map.get($outline-button-disabled-bg-colors, $type);
      border-color: map.get($outline-button-disabled-colors, $type);

      .icon {
        color: map.get($outline-button-disabled-colors, $type);
      }
    }
  }
}

// Scoped 타입 버튼 (info, primary)
$scoped-button-configs: (
  'info': (
    'border': map.get(color.$layout-border, 'info'),
    'text': map.get(color.$text-status, 'info'),
    'hover-bg': map.get(color.$layout-status, 'info-bg-sub'),
    'active-border': map.get(color.$label-shipping, 'tomorrow'),
    'active-text': map.get(color.$layout-border, 'info'),
    'active-bg': map.get(color.$label-shipping, 'tomorrow'),
    'padding-x': 25
  ),
  'primary': (
    'border': map.get(color.$layout-border, 'brand'),
    'text': map.get(color.$text-status, 'brand'),
    'hover-bg': map.get(color.$layout-status, 'brand-bg-sub'),
    'active-border': map.get(color.$layout-border, 'brand'),
    'active-text': color.$color-white,
    'active-bg': map.get(color.$layout-surf, 'brand'),
    'padding-x': 25
  )
);

.vits-btn-scoped {
  @each $type, $config in $scoped-button-configs {
    &-#{$type} {
      $border: map.get($config, 'border');
      $text: map.get($config, 'text');
      $hover-bg: if(map.has-key($config, 'hover-bg'), map.get($config, 'hover-bg'), color.$color-white);
      $active-border: if(map.has-key($config, 'active-border'), map.get($config, 'active-border'), $border);
      $active-text: if(map.has-key($config, 'active-text'), map.get($config, 'active-text'), $text);
      $active-bg: if(map.has-key($config, 'active-bg'), map.get($config, 'active-bg'), $hover-bg);

      @include mx.border(all, 1px, solid, $border);
      font-weight: 600;
      color: $text;
      background-color: color.$color-white;
      border-radius: map.get(var.$radius, 'sm');

      @if map.has-key($config, 'padding-x') {
        padding: 0 fn.rem(map.get($config, 'padding-x'));
      }

      @include mx.common-mouse-event {
        background-color: $hover-bg;

        &:active {
          @include mx.border(all, 1px, solid, $active-border);
          color: $active-text;
          background-color: $active-bg;
        }
      }

      &:disabled {
        color: map.get(color.$text-colors, 'muted');
        pointer-events: none;
        background-color: map.get(color.$gray-shades, '20');
        border-color: map.get(color.$gray-shades, '20');
      }
    }
  }
}

/* 즐겨찾기 버튼 */
.vits-btn-favorite {
  @include btn-reset;
  @include mx.flex(flex, row, center, center);
  gap: map.get(var.$unit, 4);

  .icon {
    @include icon.ic-size(map.get(var.$unit, 20));
  }

  .text {
    @include typo.typography('b3r');
  }
}

/* 텍스트 버튼 (a) */
.vits-text-link {
  @include typo.typography('b3r');
}

/* 필터 더보기 버튼 */
.filter-more-button {
  @include btn-reset;
  @include mx.flex(flex, row, center, center);
  @include mx.border('all', $color: map.get(color.$button-ghost-tertiary, 'ghost-border-tertiary-default'));
  width: 100%;
  height: map.get(var.$unit, 32);
  border-radius: map.get(var.$radius, 'md');

  .text,
  .count {
    @include typo.typography('b3b', $color: map.get(color.$button-ghost-tertiary, 'ghost-on_surf-tertiary-default'));
  }

  /* stylelint-disable-next-line no-descending-specificity */
  .icon {
    @include icon.ic-size(map.get(var.$unit, 20));
    color: map.get(color.$button-ghost-tertiary, 'ghost-on_surf-tertiary-default');
  }
}

/* vits-btn-vertical-icon */
.vits-btn-vertical-icon {
  @include mx.flex(flex, column, flex-start, center);
  gap: map.get(var.$unit, 4);

  /* stylelint-disable-next-line no-descending-specificity */
  .icon {
    @include icon.ic-size(map.get(var.$unit, 32));
    position: relative;
    color: map.get(color.$icon-neutral, 'primary');
    transition: color 0.2s ease;
  }

  .badge {
    @include mx.position(absolute, $top: 2px, $right: -3px);
    @include mx.flex(flex, row, center, center);
    @include typo.typography('b4r', $color: color.$color-white);
    width: fn.rem(15);
    height: fn.rem(15);
    background: map.get(color.$brand-colors, '100');
    border-radius: 80px;
  }

  .text {
    @include typo.typography('b4r', $color: map.get(color.$text-colors, 'secondary'));
    transition: color 0.2s ease;
  }

  @include mx.common-mouse-event {
    .icon {
      color: map.get(color.$icon-colors, 'primary');
    }

    .text {
      color: map.get(color.$text-status, 'brand');
    }
  }
}

/* -----------------------------------------------------------------------------
 * 수량 조절 컨트롤 (.quantity-control)
 * - 가로형/세로형 수량 입력 및 조절 버튼 컴포넌트
 * --------------------------------------------------------------------------- */
.quantity-control {
  overflow: hidden;
  background: color.$color-white;
  border-radius: fn.rem(6);

  @include mx.flex($align: center);
  @include mx.border(all, 1px, solid, $color: map.get(color.$layout-border, 'quaternary'));

  /* 수량 입력 필드 */
  .quantity-input {
    width: auto;
    min-width: fn.rem(48);
    height: fn.rem(36);
    padding: 0 map.get(var.$unit, 2) 0 map.get(var.$unit, 8);
    font-size: fn.rem(14);
    text-align: right;
    appearance: textfield;
    border: 0;
    outline: 0;

    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
      margin: 0;
      appearance: none;
    }
  }

  /* 수량 입력 필드 너비 측정용 (숨김) */
  .quantity-input-measure {
    position: absolute;
    padding: 0;
    margin: 0;
    white-space: pre;
    visibility: hidden;
  }

  /* 단위 표시 */
  .unit {
    height: fn.rem(36);
    padding: 0 map.get(var.$unit, 8);
    font-size: fn.rem(13);
    color: map.get(color.$text-colors, 'quaternary');
    white-space: nowrap;
    background-color: color.$color-white;

    @include mx.flex($flex: inline-flex, $align: center);
  }

  /* 증감 버튼 */
  .btn-step {
    @include btn-reset;
    flex-shrink: 0;
    width: fn.rem(36);
    height: fn.rem(36);

    @include mx.flex($justify: center, $align: center);
    @include typo.typography('b2r', $color: map.get(color.$text-colors, 'quaternary'));
    transition:
      color 0.2s ease,
      background-color 0.2s ease;

    .ic {
      color: map.get(color.$icon-neutral, 'secondary');
      transition: color 0.2s ease;
    }

    @include mx.common-mouse-event {
      background-color: map.get(color.$layout-surf, 'sunken');

      .ic {
        color: map.get(color.$icon-neutral, 'primary');
      }
    }
  }

  /* -------------------------------------------------------------------------
   * 가로형 (- 1 M +)
   * ----------------------------------------------------------------------- */
  &.type-horiz {
    .btn-step {
      background-color: color.$color-white;

      &.vits-minus-icon {
        @include mx.border(right, 1px, solid, $color: map.get(color.$layout-border, 'quaternary'));
        border-radius: map.get(var.$radius, 'sm') 0 0 map.get(var.$radius, 'sm');

        @include mx.common-mouse-event {
          &:hover {
            background-color: map.get(color.$layout-surf, 'sunken');
            border: 1px solid map.get(color.$layout-border, 'secondary');
          }

          &:active {
            background-color: map.get(color.$red-shades, '20');
            border: 1px solid map.get(color.$layout-border, 'brand');

            i.ic {
              color: map.get(color.$brand-colors, '100');
            }
          }
        }
      }

      &.vits-plus-icon {
        top: 1px;

        @include mx.border(left, 1px, solid, $color: map.get(color.$layout-border, 'quaternary'));
        border-radius: 0 map.get(var.$radius, 'sm') map.get(var.$radius, 'sm') 0;

        @include mx.common-mouse-event {
          &:hover {
            background-color: map.get(color.$layout-surf, 'sunken');
            border: 1px solid map.get(color.$layout-border, 'secondary');
          }

          &:active {
            background-color: map.get(color.$red-shades, '20');
            border: 1px solid map.get(color.$layout-border, 'brand');

            i.ic {
              color: map.get(color.$brand-colors, '100');
            }
          }
        }
      }
    }

    @include mx.common-mouse-event {
      background-color: map.get(color.$layout-surf, 'sunken');
    }

    &:has(.quantity-input:hover),
    &:has(.quantity-input:focus-visible),
    &:has(.quantity-input:active) {
      .quantity-input,
      .unit {
        background-color: map.get(color.$layout-surf, 'sunken');
        border-top: 1px solid map.get(color.$layout-border, 'secondary');
        border-bottom: 1px solid map.get(color.$layout-border, 'secondary');
      }

      .btn-step.vits-plus-icon {
        @include mx.border(left, 1px, solid, $color: map.get(color.$layout-border, 'secondary'));
      }

      .btn-step.vits-minus-icon {
        @include mx.border(right, 1px, solid, $color: map.get(color.$layout-border, 'secondary'));
      }
    }
  }

  /* -------------------------------------------------------------------------
   * 세로형 (1 M + / -)
   * ----------------------------------------------------------------------- */
  &.type-vertical {
    position: relative;
    padding-right: fn.rem(32);

    /* stylelint-disable-next-line no-descending-specificity */
    .quantity-input {
      min-width: fn.rem(56);
    }

    .btn-step {
      @include mx.position(absolute, $top: 0, $right: 0);
      width: fn.rem(32);
      height: fn.rem(18);
      font-size: fn.rem(12);

      &.vits-plus-icon {
        top: 0;

        @include mx.border(bottom, 1px, solid, $color: map.get(color.$layout-border, 'quaternary'));
        @include mx.border(left, 1px, solid, $color: map.get(color.$layout-border, 'quaternary'));
      }

      &.vits-minus-icon {
        top: auto;
        bottom: 0;

        @include mx.border(left, 1px, solid, $color: map.get(color.$layout-border, 'quaternary'));
      }
    }
  }
}

/* icon text button */
//  $color: map.get(color.$text-status, 'info')
.vits-ictext-button {
  @include btn-reset;
  @include mx.flex(flex, row, flex-start, center);

  // 사이즈별 토큰 맵
  $sizes: (
    sm: (
      gap: map.get(var.$unit, 2),
      icon: map.get(var.$unit, 16),
      typo: 'b4r'
    ),
    md: (
      gap: map.get(var.$unit, 4),
      icon: map.get(var.$unit, 20),
      typo: 'b3r'
    )
  );

  @each $key, $opt in $sizes {
    &-#{$key} {
      gap: map.get($opt, gap);

      .icon {
        @include icon.ic-size(map.get($opt, icon));
        color: map.get(color.$icon-neutral, 'primary');
      }

      .text {
        @include typo.typography(map.get($opt, typo));
      }
    }
  }

  // 텍스트 컬러 맵(이름: 색상값)
  $text-colors: (
    info: map.get(color.$text-status, 'info')
  );

  // .vits-text-info / .vits-text-success ... 생성
  @each $name, $value in $text-colors {
    &.vits-text-#{$name} .text {
      color: $value;
    }
  }
}

/* vits-text-underline-button */
.vits-text-underline-button {
  @include btn-reset;
  @include mx.border('bottom', $color: map.get(color.$layout-surf, 'secondary'));
  @include typo.typography('b4r', $color: map.get(color.$text-colors, 'secondary'));
  height: fn.rem(19);
  background: transparent;

  &.size-m {
    @include typo.typography('b3r', $color: map.get(color.$text-colors, 'tertiary'));
    height: fn.rem(21);
  }

  &.size-l {
    @include typo.typography('b2r', $color: map.get(color.$text-colors, 'tertiary'));
    height: fn.rem(24);
  }
}

/* header 기획전 버튼 */
.vits-gnb-promo-button {
  @include mx.flex(flex, column, center, flex-start);
  height: fn.rem(60);
  padding: 0 map.get(var.$unit, 16);
  overflow: hidden;
  background: map.get(color.$layout-surf, 'base');
  border-radius: 10px;
  box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'quaternary');
  transition: box-shadow 0.25s;

  span {
    @include typo.typography('b3s');
    @include mx.ellipsis-multi(1.3, $text-overflow: false);
    flex: 0 1 auto;
    min-width: 0;
    max-width: 100%;
  }

  @include mx.common-mouse-event {
    box-shadow: inset 0 0 0 1px map.get(color.$layout-border, 'primary');
  }
}

/* button - 고정값 */
.btn-fix-w120 {
  width: fn.rem(120);
}

.btn-fix-w150 {
  width: fn.rem(150);
}

.btn-fix-w160 {
  width: fn.rem(160);
}

/* -----------------------------------------------------------------------------
  auth 탭 버튼 , mypage-coupon 탭 버튼 등 공통 스타일 01.29
 * --------------------------------------------------------------------------- */
:where([class*='vits-tabs-'][role='tablist']) {
  @include mx.flex($align: center);
  width: 100%;

  // 공통 스타일 버튼 영역
  [class*='vits-btn-'] {
    @include btn-reset;
    @include mx.flex($align: center, $justify: center);
    gap: fn.rem(10);
    width: 50%;

    .text {
      @include typo.typography('b2r', $color: map.get(color.$text-colors, 'tertiary'));
    }

    .coupon-badge {
      @include typo.typography('b4r', $color: map.get(color.$brand-colors, 'primary'));
      @include mx.flex($align: center, $justify: center);
      display: inline-flex;
      min-width: fn.rem(22);
      min-height: fn.rem(22);
      padding: 0 fn.rem(4);
      background-color: map.get(color.$layout-status, 'brand-bg-sub');
      border-radius: 50%;
    }

    &.is-active {
      @include mx.border(all, 2px, solid, map.get(color.$layout-border, 'brand'));
    }
  }

  // 크기별 스타일 (lg | sm)
  &.vits-tabs-lg {
    background-color: map.get(color.$layout-surf, 'base');
    border-radius: map.get(var.$radius, 'lg');

    [class*='vits-btn-'] {
      min-height: fn.rem(48);

      &.is-active {
        border-radius: map.get(var.$radius, 'lg');

        .text {
          @include typo.typography('b2b', $color: map.get(color.$text-status, 'brand'));
        }
      }
    }
  }

  &.vits-tabs-sm {
    padding: map.get(var.$unit, 2);
    background-color: map.get(color.$layout-surf, 'sunken');
    border-radius: map.get(var.$radius, 'sm');

    [class*='vits-btn-'] {
      min-height: fn.rem(36);

      .text {
        @include typo.typography('b3r', $color: map.get(color.$text-colors, 'tertiary'));
      }

      &.is-active {
        background-color: map.get(color.$layout-surf, 'base');
        border-width: 1px;
        border-radius: map.get(var.$radius, 'sm');

        .text {
          @include typo.typography('b3b', $color: map.get(color.$text-status, 'brand'));
        }
      }
    }
  }
}
