// -----------------------------------------------------------------------------
// components/_modal.scss
// - data-modal-* ê¸°ë°˜ ë ˆì´ì–´ ê³µí†µ ì• ë‹ˆë©”ì´ì…˜ ë² ì´ìŠ¤ ìŠ¤íƒ€ì¼
// - ìƒíƒœ í´ë˜ìŠ¤: is-open(display on) / is-active(visible on) / is-closing(leave)
// -----------------------------------------------------------------------------

@use 'sass:map';
@use '@/assets/scss/abstracts/variables' as var;
@use '@/assets/scss/abstracts/mixins' as mx;
@use '@/assets/scss/abstracts/functions' as fn;
@use '@/assets/scss/base/colors' as color;
@use '@/assets/scss/base/typography' as typo;
@use '@/assets/scss/components/icon' as icon;
@use '@/assets/scss/components/button' as button;

/* ê³µí†µ ë¯¹ìŠ¤ì¸ */

@mixin layer-hidden {
  display: none;
  pointer-events: none;
  visibility: hidden;
  opacity: 0;
}

@mixin layer-visible {
  pointer-events: auto;
  visibility: visible;
  opacity: 1;
}

@mixin layer-transition($delay: 0.35s) {
  transition:
    transform $delay ease,
    opacity $delay ease,
    visibility 0s $delay;
}

@mixin layer-transition-active {
  transition:
    transform 0.35s ease,
    opacity 0.35s ease,
    visibility 0s 0s;
}

/* ë”¤ ë ˆì´ì–´ */

[data-modal-dim] {
  @include layer-hidden;
  @include mx.position(absolute, 0, 0, 0, 0);
  z-index: var.$zindex-modal-dim;
  background-color: color.$color-dim;
  transition:
    opacity 0.35s ease,
    visibility 0s 0.35s;

  &.is-open {
    display: block;
  }

  &.is-open.is-active {
    @include layer-visible;
    transition:
      opacity 0.35s ease,
      visibility 0s 0s;
  }

  &.is-open.is-closing {
    @include layer-hidden;
    transition:
      opacity 0.35s ease,
      visibility 0s 0.35s;
  }
}

/* ëª¨ë‹¬ ë°•ìŠ¤ (ê³µí†µ) */

[data-modal-box] {
  @include layer-hidden;
  @include layer-transition;

  &.is-open {
    display: block;
  }

  &.is-open.is-active {
    @include layer-visible;
    @include layer-transition-active;
  }

  &.is-open.is-closing {
    @include layer-hidden;
    @include layer-transition;
  }
}

/* íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ */

// ëª¨ë‹¬
[data-modal-box][data-modal-type='modal'] {
  @include mx.position(fixed, 0, 0, 0, 0);
  z-index: var.$zindex-modal;
  transform: translateY(8px) scale(0.98);

  &.is-open.is-active {
    transform: translateY(0) scale(1);
  }

  &.is-open.is-closing {
    transform: translateY(8px) scale(0.98);
  }
}

// ë°”í…€ì‹œíŠ¸
[data-modal-box][data-modal-type='bottom'] {
  @include mx.position(fixed, 0, 0, 0, 0);
  z-index: var.$zindex-modal;
  transform: translateY(16px);

  &.is-open.is-active {
    transform: translateY(0);
  }

  &.is-open.is-closing {
    transform: translateY(16px);
  }
}

// ìŠ¬ë¼ì´ë“œ (ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ)
[data-modal-box][data-modal-type='slide-right'] {
  [class$='-panel'] {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    transition:
      transform 0.4s cubic-bezier(0.22, 1, 0.36, 1),
      opacity 0.3s ease,
      visibility 0s 0.3s;
    transform: translateX(100%);
    transform-origin: right center;
  }

  &.is-open.is-active {
    [class$='-dim'] {
      transition: none;
      transform: none;
    }

    [class$='-panel'] {
      transition:
        transform 0.4s cubic-bezier(0.22, 1, 0.36, 1),
        opacity 0.3s ease,
        visibility 0s 0s;
      transform: translateX(0);
    }
  }

  &.is-open.is-closing {
    [class$='-panel'] {
      transform: translateX(100%);
    }
  }
}

/* ì ‘ê·¼ì„± */

@media (prefers-reduced-motion: reduce) {
  [data-modal-box],
  [data-modal-dim] {
    transition: none;
  }
}

/* =============================================================
  ğŸš« DO NOT MODIFY ABOVE THIS LINE
  ìœ„ ìŠ¤íƒ€ì¼ì€ ì „ì²´ ë ˆì´ì–´ ì‹œìŠ¤í…œ ê³µí†µ ë² ì´ìŠ¤ì…ë‹ˆë‹¤.
  ê°œë³„ ë ˆì´ì–´ ìŠ¤íƒ€ì¼ì€ ì´ ì˜ì—­ ì•„ë˜ì—ì„œë§Œ ì‘ì„±í•˜ì„¸ìš”.
============================================================= */

/* ê°œë³„ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì˜ì—­ */
// ëª¨ë‹¬ Inner (ì‹¤ì œ ëª¨ë‹¬ ë°•ìŠ¤)
$modal-widths: (
  480: 480,
  710: 710
);

.vits-modal {
  &-inner {
    @include mx.flex(flex, column, flex-start, flex-start);
    min-width: fn.rem(320);
    max-height: calc(var(--vh, 1vh) * 95);

    /* [legacy] k-window ì „í™˜ ì „ ì½”ë“œ - ì¶”í›„ ì œê±°
    @include mx.position(absolute, 50%, $left: 50%);
    z-index: var.$zindex-base;
    transform: translate(-50%, -50%); */

    > div[class*='vits-modal-'] {
      width: 100%;
    }

    @at-root .vits-modal:not([class*='width-']) & {
      max-width: 95vw;
    }

    @each $key, $w in $modal-widths {
      @at-root .vits-modal.width-#{$key} & {
        width: fn.rem($w);
      }
    }
  }

  [class*='vits-modal-'][class*='-header'],
  [class*='vits-modal-'][class*='::-moz-focus-outer'] {
    flex-shrink: 0;
  }

  // header
  &-header {
    @include mx.flex(flex, row, space-between, flex-start);
    position: relative;
    padding: map.get(var.$unit, 32) map.get(var.$unit, 32) map.get(var.$unit, 36);
    background: color.$color-white;

    /* [legacy] k-window ì „í™˜ ì „ ì½”ë“œ - ì¶”í›„ ì œê±°
    border-radius: map.get(var.$radius, 'lg') map.get(var.$radius, 'lg') 0 0; */

    &-content {
      flex-grow: 1;
      min-width: 0;
      max-width: fit-content;
      overflow: hidden;
    }
  }

  &-title,
  &-subtitle {
    @include mx.ellipsis-single;
    width: 100%;
  }

  &-title {
    @include typo.typography('h3b', $color: map.get(color.$text-colors, 'primary'));
    padding-right: map.get(var.$unit, 32);
  }

  &-subtitle {
    @include typo.typography('b3r', $color: map.get(color.$text-colors, 'tertiary'));
    margin-top: map.get(var.$unit, 4);
    word-break: keep-all;
  }

  &-infotitle {
    @include typo.typography('b3r', $color: map.get(color.$text-status, 'brand-sub'));
    margin-top: map.get(var.$unit, 4);
  }

  &-close {
    @include button.btn-reset;
    @include icon.ic-size(map.get(var.$unit, 32));
    @include mx.position(absolute, map.get(var.$unit, 32), map.get(var.$unit, 32), auto, auto);
  }

  // ì»¨í…ì¸ 
  &-content {
    flex: 1 1 auto;
    min-width: 0;
    padding: map.get(var.$unit, 4) map.get(var.$unit, 32);
    overflow: hidden auto;
    background: color.$color-white;

    /* [legacy] k-window ì „í™˜ ì „ ì½”ë“œ - ì¶”í›„ ì œê±°
    &-inner {
      max-width: 710px;
      padding: 0 map.get(var.$unit, 32);
      margin-right: fn.rem(-20); // ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ë§Œí¼ ë°€ì–´ë‚´ê¸°
    } */

    // S: k-window ìŠ¤í¬ë¡¤/í‘¸í„° ì—¬ë¶€ ëŒ€ì‘
    &.has-scroll {
      padding-right: map.get(var.$unit, 20);
    }

    &.no-footer {
      padding-bottom: map.get(var.$unit, 32);
    }

    // E: k-window ìŠ¤í¬ë¡¤/í‘¸í„° ì—¬ë¶€ ëŒ€ì‘
  }

  // footer
  &-footer {
    padding: map.get(var.$unit, 40) map.get(var.$unit, 32) map.get(var.$unit, 32);
    background: color.$color-white;

    /* [legacy] k-window ì „í™˜ ì „ ì½”ë“œ - ì¶”í›„ ì œê±°
    border-radius: 0 0 map.get(var.$radius, 'lg') map.get(var.$radius, 'lg'); */
  }

  &-btn {
    @include button.btn-reset;
    @include mx.flex(flex, row, center, center);
    height: map.get(var.$unit, 64);
    padding: map.get(var.$unit, 16) map.get(var.$unit, 12);
    border-radius: map.get(var.$radius, 'md');

    &-primary {
      background: map.get(color.$button-fill-primary, 'fill-surf-primary-default');
    }

    &-secondary {
      background: map.get(color.$button-fill-secondary, 'fill-surf-secondary-default');
    }

    &-tertiary {
      background: map.get(color.$button-fill-tertiary, 'fill-surf-tertiary-default');
    }

    .text {
      @include typo.typography('h3b', $color: map.get(color.$button-fill-primary, 'fill-on_surf-primary-default'));
    }
  }

  &-buttons {
    @include mx.flex(flex, row, center, center);
    gap: map.get(var.$unit, 12);

    &.is-single {
      .vits-modal-btn {
        flex: 1 1 auto;
        min-width: 0;
      }
    }

    &.is-double {
      .vits-modal-btn-secondary {
        flex: 2 1 0;
        min-width: 0;
      }

      .vits-modal-btn-primary {
        flex: 3 1 0;
        min-width: 0;
      }
    }
  }

  &:not(:has(.vits-modal-footer)) {
    .vits-modal-content {
      padding-bottom: map.get(var.$unit, 32);
      border-radius: 0 0 map.get(var.$radius, 'lg') map.get(var.$radius, 'lg');
    }
  }

  &.theme-compare {
    .vits-modal-content-inner {
      max-width: none !important;
      margin-right: 0 !important;
    }
  }
}

/* =============================================================
  Kendo UI Window
  - ê¸°ì¡´ vits-modal ìŠ¤íƒ€ì¼ì„ ê·¸ëŒ€ë¡œ í™œìš©í•©ë‹ˆë‹¤.
  - Kendo WindowëŠ” ëª¨ë‹¬ ê¸°ëŠ¥(ì—´ê¸°/ë‹«ê¸°/ë”¤/ì¤‘ì•™ì •ë ¬)ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤.
  - í—¤ë”/ì»¨í…ì¸ /í‘¸í„°ëŠ” ê¸°ì¡´ vits-modal-* í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - ê°œë³„ ìœˆë„ìš° ìŠ¤íƒ€ì¼ì€ ì´ ì˜ì—­ ì•„ë˜ì—ì„œ ì‘ì„±í•˜ì„¸ìš”.
============================================================= */

body:not(.is-option-modal-open) {
  .k-window:has(.vits-modal-header) {
    max-width: 95vw;
    overflow: hidden;
    border-radius: map.get(var.$radius, 'lg');

    .k-window-titlebar {
      display: none;
    }

    .k-window-content {
      min-height: 0;
      max-height: calc(var(--vh, 1vh) * 95);
      padding: 0 !important;
      overflow: visible;

      // ì¢‹ì•„ìš” í´ë”
      /* stylelint-disable-next-line selector-id-pattern */
      &#likeModal {
        max-height: calc(var(--vh, 1vh) * 50);

        .k-listview-content {
          @include mx.flex(flex, column);
          gap: map.get(var.$unit, 12);

          > .k-listview-item {
            margin-bottom: 0 !important;
          }
        }
      }
    }

    &.is-draggable .vits-modal-header {
      cursor: move;
    }

    // ìŠ¤í¬ë¡¤ ìƒì„± ê¸°ì¤€ ì˜ˆì™¸ì²˜ë¦¬
    .vits-modal-content {
      &:has(.vits-address-select),
      &:has(.vits-claim-request .vits-claim-request-reason) {
        @include mx.flex(flex, column);

        .vits-address-select,
        .vits-claim-request {
          flex: 1 1 auto;
          min-height: 0;

          &-body {
            // margin collapseë¡œ ì¸í•œ ë¶ˆí•„ìš”í•œ ìŠ¤í¬ë¡¤ ë°©ì§€
            padding-bottom: 4px;
            overflow-y: auto;

            & + .vits-claim-request-footer {
              padding-top: map.get(var.$unit, 16);
            }
          }
        }
      }

      /* stylelint-disable-next-line no-descending-specificity */
      &:has(.vits-address-select) {
        overflow-y: hidden;
      }
    }
  }
}
