<% const _src = srcPath; const _public = publicPath; %>
<!DOCTYPE html>
<!-- 
  [D] vits-scope: 스크롤바 커스텀 범위 제한(운영 전역 scrollbar 충돌 방지)
    - 문서 스크롤 주체가 html/body로 달라질 수 있어 둘 다 클래스 적용 
  -->
<html lang="ko" class="vits-scope">
  <%- include(`${_src}/views/layout/head.ejs`, {meta_title: '장바구니/주문서'}) %>
  <!-- [D] vits-scope 적용(상단 주석 참고) -->
  <body class="vits-scope">
    <!-- S: Skip Navigation -->
    <a href="#skipNav" class="skip-nav">본문 바로가기</a>
    <!-- E: Skip Navigation -->

    <!-- S: vits-wrapper -->
    <section class="vits-wrapper">
      <%- include(`${_src}/views/layout/header.ejs`) %>

      <!-- S: vits-main -->
      <main id="skipNav" class="vits-main">
        <!-- S: vits-wrap -->
        <div class="vits-wrap">
          <!-- S: vits-grid -->
          <div class="vits-grid">
            <!-- S: vits-grid-main -->
            <div class="vits-grid-main vits-main-cart-order">
              <div class="vits-inner inner-column">
                <!-- 1280 컨텐츠 -->

                <div class="vits-grid-area">
                  <div class="vits-grid-main-content">
                    <section class="main-cart-section">
                      <%- include(`${_src}/views/components/pg-cart-oder/cart-list.ejs`) %>
                    </section>

                    <section class="main-shipping-section">
                      <%- include(`${_src}/views/components/pg-cart-oder/shipping-list.ejs`) %>
                    </section>
                  </div>

                  <!-- S: vits-grid-right -->
                  <aside class="vits-grid-side vits-grid-side-right vits-side-payment">
                    <section class="main-payment-section">
                      <%- include(`${_src}/views/components/pg-cart-oder/payment-list.ejs`) %>
                      <!-- 최종 결제 버튼 -->
                      <div class="vits-payment-submit">
                        <%- include(`${_src}/views/components/button/button.ejs`, {
                          size: 'xxl',
                          variant: 'primary',
                          text: '370,950원 결제하기',
                        }) %>
                      </div>
                    </section>
                  </aside>
                  <!-- E: vits-grid-right -->
                </div>
              </div>

              <!-- full wide 컨텐츠 -->
            </div>
            <!-- E: vits-grid-main -->
          </div>
          <!-- E: vits-grid -->
        </div>
        <!-- E: vits-wrap -->
      </main>
      <!-- E: vits-main -->

      <%- include(`${_src}/views/layout/footer.ejs`) %>
    </section>
    <!-- E: vits-wrapper -->

    <%- include(`${_src}/views/layout/footer.links.ejs`) %>

    <script>
      // [REMOVE] 퍼블 확인용 임시 코드 - 개발 적용 시 제거
      
      (function() {
        // 전체선택 체크박스 선택자
        const selectAllCheckbox = document.querySelector('input[type="checkbox"][value="전체선택"]');
        const cartItems = document.querySelectorAll('.vits-cart-item');
        
        if (!selectAllCheckbox) return;
        
        // 전체선택 체크박스 변경 이벤트
        selectAllCheckbox.addEventListener('change', function() {
          const isChecked = this.checked;
          
          // is-sold-out이 없는 모든 vits-cart-item의 체크박스 선택/해제
          cartItems.forEach(function(item) {
            // is-sold-out이 있으면 제외
            if (item.classList.contains('is-sold-out')) {
              return;
            }
            
            const itemCheckbox = item.querySelector('input[type="checkbox"][name="vits-cart-checkbox"]');
            if (itemCheckbox) {
              itemCheckbox.checked = isChecked;
            }
          });
        });
        
        // 개별 체크박스 변경 이벤트
        cartItems.forEach(function(item) {
          // is-sold-out이 있으면 이벤트 리스너 추가하지 않음
          if (item.classList.contains('is-sold-out')) {
            return;
          }
          
          const itemCheckbox = item.querySelector('input[type="checkbox"][name="vits-cart-checkbox"]');
          if (itemCheckbox) {
            itemCheckbox.addEventListener('change', function() {
              updateSelectAllState();
            });
          }
        });
        
        // 전체선택 상태 업데이트 함수
        function updateSelectAllState() {
          let allChecked = true;
          let hasValidItems = false;
          
          cartItems.forEach(function(item) {
            // is-sold-out이 있으면 제외
            if (item.classList.contains('is-sold-out')) {
              return;
            }
            
            hasValidItems = true;
            const itemCheckbox = item.querySelector('input[type="checkbox"][name="vits-cart-checkbox"]');
            if (itemCheckbox && !itemCheckbox.checked) {
              allChecked = false;
            }
          });
          
          // 유효한 항목이 있고 모두 체크되어 있으면 전체선택도 체크
          if (hasValidItems) {
            selectAllCheckbox.checked = allChecked;
          }
        }
        
        // 초기 상태 설정
        updateSelectAllState();
      })();
    </script>
  </body>
</html>
