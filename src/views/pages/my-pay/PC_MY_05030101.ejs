<% const _src = srcPath; const _public = publicPath; %>
<!DOCTYPE html>
<!--
  [D] vits-scope: 스크롤바 커스텀 범위 제한(운영 전역 scrollbar 충돌 방지)
    - 문서 스크롤 주체가 html/body로 달라질 수 있어 둘 다 클래스 적용
  -->
<html lang="ko" class="vits-scope">
  <%- include(`${_src}/views/layout/head.ejs`, {meta_title: '비츠온페이-카드 관리'}) %>
  <!-- [D] vits-scope 적용(상단 주석 참고) -->
  <body class="vits-scope">
    <!-- S: Skip Navigation -->
    <a href="#skipNav" class="skip-nav">본문 바로가기</a>
    <!-- E: Skip Navigation -->

    <!-- S: vits-wrapper -->
    <section class="vits-wrapper">
      <%- include(`${_src}/views/layout/header.ejs`) %>

      <!-- S: vits-main -->
      <main id="skipNav" class="vits-main">
        <!-- S: vits-wrap -->
        <div class="vits-wrap">
          <!-- S: vits-grid -->
          <div class="vits-grid">
            <!-- S: vits-grid-main -->
            <div class="vits-grid-main vits-main-my-paymanage">
              <div class="vits-inner inner-column">
                <!-- 1280 컨텐츠 -->
                <div class="vits-grid-area">
                  <!-- S: vits-grid-side-left -->
                  <!-- prettier-ignore -->
                  <%- include(`${_src}/views/layout/lnb/lnb-mypage.ejs`, {currentMenu: 'info-pay'}) %>
                  <!-- E: vits-grid-side-left -->

                  <div class="vits-grid-main-content main-content-paymanage">
                    <!-- 메인 컨텐츠 -->

                    <!-- 컨텐츠 헤딩 -->
                    <div class="vits-mypage-content-headline pay-headline">
                      <h2 class="vits-mypage-content-title">비츠온페이 관리</h2>

                      <!-- prettier-ignore -->
                      <%- include(`${_src}/views/components/button/button.ejs`, {
                        size: 'sm',
                        variant: 'outline-tertiary',
                        text: '결제비밀번호 설정',
                        iconLeft: true,
                        iconName: 'ic-lock-close',
                        className: 'pay-headline-link'
                      }) %>
                    </div>

                    <div class="vits-mypage-panel">
                      <!-- prettier-ignore -->
                      <%- include(`${_src}/views/components/tabs.ejs`, {
                        size: 'lg',
                        className: 'pay-tabs',
                        tabClassName: 'vits-btn-md pay-tab-btn',
                        tabs: [
                          { text: '카드 관리', isActive: true },
                          { text: '계좌 관리', isActive: false }
                        ],
                        showBadge: false,
                        ariaLabel: '비츠온페이 탭',
                        idPrefix: 'pay-tab'
                        }) %>

                      <div class="vits-mypage-panel-inner">
                        <!--등록된 결제수단이 없을 때 (type=none 일 때만 노출) -->
                        <div class="pay-panel-empty" hidden>
                          <!-- prettier-ignore -->
                          <% const buttonHtml = include(`${_src}/views/components/button/button.ejs`, {
                            size: 'xl',
                            variant: 'secondary',
                            text: '결제수단 등록',
                            iconLeft: true,
                            iconName: 'ic-plus',
                            className: 'pay-reg-btn' }) 
                          %>
                          <!-- prettier-ignore -->
                          <%- include(`${_src}/views/components/empty-state.ejs`, {
                            iconName: 'document-paper',
                              title: '등록된 결제수단이 없습니다.',
                              desc: '결제수단을 등록해주세요',
                              buttonHtml
                            }) %>
                        </div>

                        <!-- 결제수단 목록 영역 (type=card | type=bank 일 때 노출) -->
                        <div class="pay-panel-has-items">
                          <!-- 결제수단 등록 버튼 -->
                          <!-- prettier-ignore -->
                          <%- include(`${_src}/views/components/button/button.ejs`, {
                            size: 'xl',
                            variant: 'secondary',
                            text: '결제수단 등록',
                            iconLeft: true,
                            iconName: 'ic-plus',
                            className: 'pay-reg-btn'
                          }) %>

                          <% const cardItems = [
                              { itemName: '신한카드 [나만의 카드]', itemNum: '3318 **** **** ****' },
                              { itemName: 'KB국민카드 [체크]', itemNum: '5521 **** **** ****' },
                              { itemName: '삼성카드 [신용]', itemNum: '4532 **** **** ****' },
                              { itemName: '현대카드 [포인트]', itemNum: '1234 **** **** ****' }
                            ];
                            const bankItems = [
                              { itemName: '우리은행 [별칭]', itemNum: '12344145 ******' },
                              { itemName: '신한은행 [급여]', itemNum: '110-123-******' },
                              { itemName: '국민은행 [적금]', itemNum: '123-45-******' },
                              { itemName: '하나은행 [입출금]', itemNum: '123-456-******' },
                              { itemName: '농협은행 [통장]', itemNum: '123-12-******' },
                              { itemName: '기업은행 [개인]', itemNum: '123-45678-******' }
                            ];
                          %>

                          <!--[D] type=card-->
                          <div
                            class="pay-card-list pay-card-list-card"
                            data-toggle-scope
                            data-toggle-group="true"
                            data-pay-type="card"
                          >
                            <% cardItems.forEach(function(item, i) { %>
                            <!-- prettier-ignore -->
                            <%- include(`${_src}/views/components/pg-my-paymanage/my-paymanage-items.ejs`, {
                              type: 'card',
                              showBadge: i === 0,
                              badgeText: '대표',
                              itemName: item.itemName,
                              itemNum: item.itemNum,
                              menuIndex: i
                            }) %>
                          <% }); %>
                          </div>

                          <!-- [D] type=bank-->
                          <div
                            class="pay-card-list pay-card-list-bank"
                            data-toggle-scope
                            data-toggle-group="true"
                            data-pay-type="bank"
                            style="display: none"
                          >
                            <% bankItems.forEach(function(item, i) { %>
                            <!-- prettier-ignore -->
                            <%- include(`${_src}/views/components/pg-my-paymanage/my-paymanage-items.ejs`, {
                              type: 'bank',
                              showBadge: i === 0,
                              badgeText: '대표',
                              itemName: item.itemName,
                              itemNum: item.itemNum,
                              menuIndex: i + 10
                            }) %>
                          <% }); %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- full wide 컨텐츠 -->
            </div>
            <!-- E: vits-grid-main -->
          </div>
          <!-- E: vits-grid -->
        </div>
        <!-- E: vits-wrap -->
      </main>
      <!-- E: vits-main -->

      <%- include(`${_src}/views/layout/footer.ejs`) %>
    </section>
    <!-- E: vits-wrapper -->

    <%- include(`${_src}/views/layout/footer.links.ejs`) %>

    <script>
      /**
       * [REMOVE] 퍼블 확인용 - 개발 적용 시 제거
       * type 파라미터에 따라 document.title 및 카드/계좌 목록 노출 제어
       * type=card → 카드 4개(대표 1개만 배지), type=bank → 계좌 6개(대표 1개만 배지)
       * 비츠온페이관리 페이지는 html하나로 관리하지만, 카드와 계좌 목록을 구분하여 노출
       */
      (function () {
        var urlParams = new URLSearchParams(window.location.search);
        var type = (urlParams.get('type') || 'card').toLowerCase();

        var titles = {
          card: '비츠온페이-카드 관리',
          bank: '비츠온페이-계좌 관리',
          none: '비츠온페이 관리 - 목록 없음'
        };
        document.title = titles[type] || titles.card;

        var panelEmpty = document.querySelector('.pay-panel-empty');
        var panelHasItems = document.querySelector('.pay-panel-has-items');
        if (panelEmpty && panelHasItems) {
          if (type === 'none') {
            panelEmpty.removeAttribute('hidden');
            panelHasItems.setAttribute('hidden', '');
          } else {
            panelEmpty.setAttribute('hidden', '');
            panelHasItems.removeAttribute('hidden');
          }
        }

        var listCard = document.querySelector('.pay-card-list-card');
        var listBank = document.querySelector('.pay-card-list-bank');
        if (listCard && listBank) {
          if (type === 'bank') {
            listCard.style.display = 'none';
            listBank.style.display = '';
          } else {
            listCard.style.display = '';
            listBank.style.display = 'none';
          }
        }

        var tabCard = document.getElementById('pay-tab-0');
        var tabBank = document.getElementById('pay-tab-1');
        if (tabCard && tabBank) {
          if (type === 'bank') {
            tabCard.classList.remove('is-active');
            tabCard.setAttribute('aria-selected', 'false');
            tabBank.classList.add('is-active');
            tabBank.setAttribute('aria-selected', 'true');
          } else {
            tabCard.classList.add('is-active');
            tabCard.setAttribute('aria-selected', 'true');
            tabBank.classList.remove('is-active');
            tabBank.setAttribute('aria-selected', 'false');
          }
        }
      })();
    </script>
  </body>
</html>
