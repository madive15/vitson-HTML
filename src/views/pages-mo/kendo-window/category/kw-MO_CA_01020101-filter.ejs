<% const _src = srcPath; const _public = publicPath; %>
<!-- prettier-ignore -->
<%
const _items = (typeof filterItems !== 'undefined' && filterItems) ? filterItems : [];
const _brandVisible = 6;
const _categoryVisible = 6;
%>

<div class="vm-filter-popup" data-filter-popup>
  <!-- 결과 내 재검색 -->
  <div class="filter-popup-search">
    <h3 class="filter-popup-search-title">결과 내 재검색</h3>
    <div class="filter-popup-search-inner">
      <!-- prettier-ignore -->
      <%- include(`${_src}/views/components/form/input-search.ejs`, {
        idPrefix: 'mo-filter-search',
        action: '#!',
        name: 'mo-filter-search',
        placeholder: '결과 내 재검색',
        addClassName: 'mo-filter-search'
      }) %>
    </div>
  </div>

  <!-- 필터 그룹 -->
  <!-- prettier-ignore -->
  <% _items.forEach(function(group) { %>
  <%
    var isBrand = group.name === 'ck-brand';
    var isAttr = group.name === 'ck-attr';
    var isCategory = group.name === 'ck-category';
  %>
  <div class="filter-popup-section is-collapsible" data-filter-group="<%= group.name %>">
    <button type="button" class="filter-popup-button" data-filter-toggle aria-expanded="true">
      <span class="text"><%= group.label %></span>
      <span class="icon"> <%- include(`${_src}/views/components/icon.ejs`, { iconName: 'arrow-down' }) %> </span>
    </button>

    <div class="filter-popup-body">
      <% if (isCategory) { %>
      <!-- 카테고리 트리 -->
      <% var _treeData = group.treeData || []; var _treeVisible = _treeData.slice(0, _categoryVisible); var _treeHidden
      = _treeData.slice(_categoryVisible); var _treeTotal = _treeData.length; %>
      <div data-search-more-scope>
        <!-- prettier-ignore -->
        <%- include(`${_src}/views/components/category/category-tree-search.ejs`, {
          treeData: _treeVisible
        }) %>

        <% if (_treeHidden.length) { %>
        <div data-search-more-toggle style="display: none">
          <!-- prettier-ignore -->
          <%- include(`${_src}/views/components/category/category-tree-search.ejs`, {
            treeData: _treeHidden
          }) %>
        </div>

        <div class="filter-more">
          <button type="button" class="filter-more-button" data-search-more-btn>
            <span class="icon"><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'plus' }) %></span>
            <span class="text">더보기 <em class="count">(<%= _treeTotal %>개)</em></span>
          </button>
        </div>
        <% } %>
      </div>

      <% } else if (isBrand) { %>
      <!-- 브랜드 -->
      <% var _brandData = group.filters || []; var _brandVisibleData = _brandData.slice(0, _brandVisible); var
      _brandHiddenData = _brandData.slice(_brandVisible); var _brandTotal = _brandData.length; %>
      <div data-search-more-scope>
        <!-- prettier-ignore -->
        <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
          variant: 'basic',
          size: 'm',
          name: group.name,
          list: 'column',
          gap: 16,
          datas: _brandVisibleData.map(function(f) {
            return { text: f.text, value: f.value, qty: f.qty || 0 };
          })
        }) %>

        <% if (_brandHiddenData.length) { %>
        <div data-search-more-toggle style="display: none">
          <!-- prettier-ignore -->
          <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
            variant: 'basic',
            size: 'm',
            name: group.name,
            list: 'column',
            gap: 16,
            datas: _brandHiddenData.map(function(f) {
              return { text: f.text, value: f.value, qty: f.qty || 0 };
            })
          }) %>
        </div>

        <div class="filter-more">
          <button type="button" class="filter-more-button" data-search-more-btn>
            <span class="icon"><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'plus' }) %></span>
            <span class="text">더보기 <em class="count">(<%= _brandTotal %>개)</em></span>
          </button>
        </div>
        <% } %>
      </div>

      <% } else if (isAttr) { %>
      <!-- prettier-ignore -->
      <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
        variant: 'basic',
        size: 'm',
        name: group.name,
        list: 'column',
        gap: 16,
        datas: group.filters.map(function(f) {
          return { text: f.text, value: f.value, qty: f.qty || 0 };
        })
      }) %>

      <% } else { %>
      <!-- prettier-ignore -->
      <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
        variant: 'basic',
        size: 'm',
        name: group.name,
        list: 'column',
        gap: 16,
        datas: group.filters.map(function(f) {
          return { text: f.text, value: f.value };
        })
      }) %>
      <% } %>
    </div>
  </div>
  <% }); %>
</div>
