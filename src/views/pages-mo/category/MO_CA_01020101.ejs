<% const _src = srcPath; const _public = publicPath; %> <%- include(`${_src}/views/mock-data/common/category.mock.ejs`)
%> <% mockData = (typeof mockData !== 'undefined' && mockData) ? mockData : ((typeof globalThis !== 'undefined' &&
globalThis.__mockData) ? globalThis.__mockData : {}); if (mockData && mockData.category && mockData.category.path) {
mockData.category.path.depth1Id = '074069'; mockData.category.path.depth2Id = '0740690492';
mockData.category.path.depth3Id = '07406904922701'; } var treeData = (mockData && mockData.category &&
Array.isArray(mockData.category.tree)) ? mockData.category.tree : []; var depth1Id = (mockData && mockData.category &&
mockData.category.path) ? (mockData.category.path.depth1Id || '') : ''; var depth2Id = (mockData && mockData.category &&
mockData.category.path) ? (mockData.category.path.depth2Id || '') : ''; var depth3Id = (mockData && mockData.category &&
mockData.category.path) ? (mockData.category.path.depth3Id || '') : ''; %>

<!DOCTYPE html>
<html lang="ko" class="vm-scope">
  <%- include(`${_src}/views/layout-mo/header/head.ejs`, {meta_title: '카테고리 상품목록'}) %>
  <body class="vm-scope">
    <!-- S: Skip Navigation -->
    <a href="#skipNav" class="skip-nav">본문 바로가기</a>
    <!-- E: Skip Navigation -->

    <!-- S: vm-wrapper -->
    <section class="vm-wrapper">
      <!-- S: vm-wrap -->
      <div class="vm-wrap wrap-category">
        <!-- S: vm-content-wrap -->
        <div class="vm-content-wrap">
          <!-- prettier-ignore -->
          <%- include(`${_src}/views/layout-mo/header/header.ejs`, { 
            type: 'nav-bar', title: '마지막 카테고리명' 
          }) %>

          <!-- S: vm-main -->
          <main id="skipNav" class="vm-main">
            <!-- prettier-ignore -->
            <%- include(`${_src}/views/components-mo/breadcrumb/breadcrumb.ejs`, { 
              type: 'list',
              items: ['배관자재(전기)포스맥 전용', '포스맥 트레이(POSMAC TRAY)', 'POSMAC TRAY COVER']
            }) %>
          </main>
          <!-- E: vm-main -->

          <footer class="vm-footer">푸터 영역</footer>
        </div>
        <!-- E: vm-content-wrap -->

        <!-- S: vm-bottom-group -->
        <!-- prettier-ignore -->
        <%- include(`${_src}/views/layout-mo/bottom-bar/bottom-bar.ejs`, { 
          type: 'tab-bar', currentTab: 'category' 
        }) %>
        <!-- E: vm-bottom-group -->

        <!-- S: 팝업 영역 -->
        <!-- prettier-ignore -->
        <%- include(`${_src}/views/components-mo/kendo/kendo-window.ejs`, {
          id: 'categorySheet',
          variant: 'bottomsheet',
          title: '카테고리',
          contentPath: `${_src}/views/pages-mo/kendo-window/category/kw-MO_CA_01020101.ejs`,
          contentData: { _src: _src },
          buttons: [{ text: '닫기', variant: 'secondary', action: 'close' }]
        }) %>
        <!-- E: 팝업 영역 -->
      </div>
      <!-- E: vm-wrap -->
    </section>
    <!-- E: vm-wrapper -->

    <%- include(`${_src}/views/layout/footer.links.ejs`) %>

    <script type="application/json" id="vits-mockdata">
      <%- JSON.stringify(mockData || {}).replace(/</g, '\\u003c') %>
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('vits-mockdata');

        try {
          window.__mockData = el ? JSON.parse(el.textContent || '{}') : {};
        } catch (e) {
          window.__mockData = {};
        }

        var cat = window.__mockData.category || {};
        var tree = Array.isArray(cat.tree) ? cat.tree : [];
        var path = cat.path || {};

        if (window.KendoWindow) KendoWindow.initAll();

        if (window.CategorySheet) {
          CategorySheet.setData(tree, path);
          CategorySheet.init();
          CategorySheet.render();
        }

        if (window.CategoryBreadcrumb) {
          CategoryBreadcrumb.init();

          // 초기 브레드크럼 세팅
          var names = [];
          if (path.depth1Id && tree.length) {
            for (var i = 0; i < tree.length; i++) {
              if (tree[i].categoryCode === path.depth1Id) {
                names.push(tree[i].categoryNm);
                var lv2 = tree[i].categoryList || [];
                for (var j = 0; j < lv2.length; j++) {
                  if (lv2[j].categoryCode === path.depth2Id) {
                    names.push(lv2[j].categoryNm);
                    var lv3 = lv2[j].categoryList || [];
                    for (var k = 0; k < lv3.length; k++) {
                      if (lv3[k].categoryCode === path.depth3Id) {
                        names.push(lv3[k].categoryNm);
                      }
                    }
                  }
                }
              }
            }
          }
          if (names.length) CategoryBreadcrumb.update(names);
        }
      });
    </script>
  </body>
</html>
