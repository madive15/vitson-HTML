<% const _src = srcPath; const _public = publicPath; %>
<!-- prettier-ignore -->
<%#
  상품 카드 컴포넌트 (Product Card Unit)
  ─────────────────────────────────────────
  @param {string}  type             - 상품 카드 타입 (default: 'default')
    'default'  : 기본형 - 회원 (일반 가격 + 배지)
    'soldout'  : 일시품절 (품절 표시 + 배지)
    'guest'    : 비회원 (product-price/product-spec 비노출, 배지 노출)
    'cart'     : 장바구니 담기 버튼 (일반 가격 + 배지 + 장바구니 버튼)
    ※ 새로운 type 추가 시 price/extra/action 분기만 추가하면 확장 가능

  @param {string}  imgSrc - 상품 이미지 경로 (default: temp 샘플 이미지)
  @param {string}  imgAlt - 상품 이미지 alt 텍스트 (default: '')
  @param {boolean} showHoverActions - 호버 액션(좋아요, 장바구니) 노출 여부
    지정하지 않으면 type별 기본값 적용:
    default → true / soldout → false / guest → false / cart → false
  @param {boolean} showFrequentBadge - 빈번 구매 배지 노출 여부 (default: false)
  @param {number}  frequentCount - 빈번 구매 횟수 (default: 0, showFrequentBadge가 true일 때만 사용)
  @param {boolean} showRankBadge - 순위 배지 노출 여부 (default: false)
  @param {number}  rankCount - 순위 횟수 (default: 0, showRankBadge가 true일 때만 사용)
%>
<%
  const type = locals.type || 'default';
  const imgSrc = locals.imgSrc || `${_public}/resources/img/mro/renewal/temp/temp-sample-product-02.jpg`;
  const imgAlt = locals.imgAlt || '';

  // type별 hover 기본값 맵
  const hoverDefaults = {
    default   : true,
    soldout   : false,
    guest     : false,
    cart      : false,
  };

  // showHoverActions 명시적 전달 시 우선, 아니면 type 기본값, 둘 다 없으면 false
  const showHoverActions = typeof locals.showHoverActions !== 'undefined'
    ? locals.showHoverActions
    : (hoverDefaults[type] !== undefined ? hoverDefaults[type] : false);

  // 빈번 구매 배지 옵션
  const showFrequentBadge = typeof locals.showFrequentBadge !== 'undefined' ? locals.showFrequentBadge : false;
  const frequentCount = typeof locals.frequentCount !== 'undefined' ? locals.frequentCount : 0;

  // 순위 배지 옵션
  const showRankBadge = typeof locals.showRankBadge !== 'undefined' ? locals.showRankBadge : false;
  const rankCount = typeof locals.rankCount !== 'undefined' ? locals.rankCount : 0;
%>
<article class="home-product-item">
  <div class="product-thumb">
    <a href="#!">
      <img src="<%= imgSrc %>" alt="<%= imgAlt %>" />
    </a>

    <% if (showHoverActions) { %>
    <!-- [D] 상품호버시 노출 영역 (좋아요, 장바구니)-->
    <div class="product-actions-hover">
      <div class="product-actions">
        <button type="button" class="product-action-like" aria-label="좋아요">
          <span class="icon">
            <i class="ic"></i>
          </span>
          <span class="text">좋아요</span>
        </button>

        <button type="button" class="product-action-cart" aria-label="장바구니">
          <span class="icon">
            <i class="ic"></i>
          </span>
          <span class="text">장바구니</span>
        </button>
      </div>
    </div>
    <% } %>

    <!-- 순위 배지 (이미지 위에 표시) -->
    <% if (showRankBadge && rankCount > 0) { %>
    <div class="product-rank-badge">
      <div class="product-rank-count"><%= rankCount %></div>
    </div>
    <% } %>
  </div>

  <div class="product-body">
    <div class="product-meta">
      <div class="product-brand"><span class="sr-only">브랜드</span>농심</div>
    </div>

    <div class="product-summary">
      <a href="#!">
        <div class="product-name"><span class="sr-only">상품명</span>더블 OPP 접착테이프 투명 (초강력 접착제)</div>
      </a>
    </div>

    <% if (type !== 'guest') { %>
    <!-- guest일 때 product-price 영역 비노출 -->
    <div class="product-price">
      <% if (type === 'soldout') { %>
      <!-- 일시품절 -->
      <div class="product-price-alt is-soldout">일시품절</div>
      <% } else { %>
      <!-- 가격 노출 (회원 & 판매중) : default, cart 등 -->
      <div class="vits-price-box is-normal">
        <div class="price-origin-label"><span class="sr-only">표준단가(정상가)</span>999,999,999원</div>
        <div class="price-sale-row">
          <div class="price-rate"><span class="sr-only">할인율</span>99%</div>
          <div class="price-sale"><span class="sr-only">공급단가(판매가)</span>999,999,999원</div>
        </div>
      </div>
      <% } %>
    </div>
    <% } %>

    <!-- 배지 영역 -->
    <div class="product-extra">
      <div class="vits-product-flags">
        <span class="vits-product-flag is-today">
          <span class="icon"><i class="ic ic-lightning" aria-hidden="true"></i></span>
          오늘출발
        </span>
        <span class="vits-product-flag is-tomorrow">내일출발</span>
        <span class="vits-product-flag is-hot">특가</span>
      </div>
      <div class="vits-product-promo">
        <span class="vits-product-promo-badge is-free-ship">무료배송</span>
      </div>
    </div>
    <% if (type === 'cart') { %>
    <!-- + 장바구니 담기 버튼 -->
    <div class="product-action-cart">
      <button class="product-cart-button">
        <span class="icon"><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'bag' }) %></span>
        <span class="text">장바구니 담기</span>
      </button>
    </div>
    <% } %>
    <!-- 빈번 구매 배지 -->
    <% if (showFrequentBadge && frequentCount > 0) { %>
    <div class="product-frequent-badge">
      <div class="product-frequent-count"><%= frequentCount %>회 구매</div>
    </div>
    <% } %>
  </div>
</article>
