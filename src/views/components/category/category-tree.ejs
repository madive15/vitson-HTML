<!-- prettier-ignore -->
<%# category-tree.ejs: 검색결과 카테고리 트리 (1뎁스 단위 블록 × N개, 기본 접힘) %>
<%
  var _tree = Array.isArray(treeData) ? treeData : [];
  function _validList(list) {
    if (!Array.isArray(list)) return [];
    return list.filter(function (n) { return n && n.categoryCode; });
  }
%>

<div class="vits-category-tree-list">
  <!-- prettier-ignore -->
  <% _tree.forEach(function (lv1) {
    if (!lv1 || !lv1.categoryCode) return;
    var d1Code = String(lv1.categoryCode);
    var lv2List = _validList(lv1.categoryList);
    var hasLv2 = lv2List.length > 0;
  %>
  <nav class="vits-category-tree" aria-label="<%= lv1.categoryNm || '' %>">
    <ul class="category-tree-depth1">
      <li class="category-tree-item">
        <button
          type="button"
          class="category-tree-btn"
          data-depth="1"
          data-id="<%= d1Code %>"
          data-has-children="<%= hasLv2 ? 'true' : 'false' %>"
          aria-expanded="false"
        >
          <span class="category-tree-text"><%= lv1.categoryNm || '' %></span>
          <% if (hasLv2) { %>
          <span class="icon"><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'arrow-down' }) %></span>
          <% } %>
        </button>

        <% if (hasLv2) { %>
        <div class="category-tree-panel">
          <ul class="category-tree-depth2">
            <% lv2List.forEach(function (lv2) { var d2Code = String(lv2.categoryCode); var lv3List =
            _validList(lv2.categoryList); var hasLv3 = lv3List.length > 0; %>
            <li class="category-tree-item">
              <button
                type="button"
                class="category-tree-btn"
                data-depth="2"
                data-id="<%= d2Code %>"
                data-has-children="<%= hasLv3 ? 'true' : 'false' %>"
                aria-expanded="false"
              >
                <span class="category-tree-text"><%= lv2.categoryNm || '' %></span>
                <% if (hasLv3) { %>
                <span class="icon"
                  ><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'arrow-down' }) %></span
                >
                <% } %>
              </button>

              <% if (hasLv3) { %>
              <div class="category-tree-panel">
                <ul class="category-tree-depth3">
                  <% lv3List.forEach(function (lv3) { var d3Code = String(lv3.categoryCode); %>
                  <li class="category-tree-item">
                    <button
                      type="button"
                      class="category-tree-btn"
                      data-depth="3"
                      data-id="<%= d3Code %>"
                      data-has-children="false"
                      aria-expanded="false"
                    >
                      <span class="category-tree-text"><%= lv3.categoryNm || '' %></span>
                    </button>
                  </li>
                  <% }) %>
                </ul>
              </div>
              <% } %>
            </li>
            <% }) %>
          </ul>
        </div>
        <% } %>
      </li>
    </ul>
  </nav>
  <% }) %>
</div>
