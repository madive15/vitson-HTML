<%
  const _rootClass = typeof rootClass !== 'undefined' ? String(rootClass) : '';
  const _count = typeof count !== 'undefined' ? !!count : false;

  const _id = typeof id !== 'undefined' ? String(id) : '';
  const _name = typeof name !== 'undefined' ? String(name) : '';
  const _label = (typeof label !== 'undefined' && label) ? label : '';
  const _placeholder = typeof placeholder !== 'undefined' ? String(placeholder) : '';
  const _value = typeof value !== 'undefined' ? String(value) : '';
  const _rows = typeof rows !== 'undefined' ? parseInt(rows, 10) : 4;
  const _maxLength = typeof maxLength !== 'undefined' ? parseInt(maxLength, 10) : 0;
  const _required = typeof required !== 'undefined' ? !!required : true;

  // ===== Validation 관련 =====
  const _errorMessage = (typeof validationMessage !== 'undefined' && validationMessage) ? validationMessage : '';
  const _successMessage = (typeof successMessage !== 'undefined' && successMessage) ? successMessage : '';
  
  const _isInvalidFlag = (typeof isInvalid !== 'undefined') ? (isInvalid === true) : false;
  const _isInvalid = _isInvalidFlag || !!_errorMessage;
  
  const _isValid = (typeof isValid !== 'undefined') ? (isValid === true) : false;

  // 표시할 메시지 결정 (에러 우선)
  const _displayMessage = _isInvalid ? _errorMessage : (_isValid ? _successMessage : '');
  const _hasMessage = !!_displayMessage;

  const _validationId = _id ? `${_id}-validation` : '';

  // ===== 초기 상태 클래스 구성 =====
  // NOTE: 유효성 검사 구현 시
  // - 검사 활성화: .vits-validation 클래스 추가
  // - 성공 상태: .is-valid 클래스 추가 (successMessage와 함께 사용)
  // - 실패 상태: .is-invalid 클래스 추가 (validationMessage와 함께 사용)
  // - 메시지 표시: hidden 속성 제거
  let _stateClasses = [];
  
  if (_isInvalid) {
    _stateClasses.push('vits-validation');
    _stateClasses.push('is-invalid');
  } else if (_isValid) {
    _stateClasses.push('vits-validation');
    _stateClasses.push('is-valid');
  }
  
  const _stateClass = _stateClasses.join(' ');
%>

<div class="vits-textarea-box <%= _rootClass %> <%= _stateClass %>">
  <div class="vits-textarea" data-textarea-count="<%= _count ? 'true' : 'false' %>">
    <div class="textarea-box">
      <label for="<%= _id %>" class="sr-only"><%= _label %></label>
      <textarea
        rows="<%= _rows %>"
        <% if (_id) { %>id="<%= _id %>"<% } %>
        <% if (_name) { %>name="<%= _name %>"<% } %>
        <% if (_placeholder) { %>placeholder="<%= _placeholder %>"<% } %>
        <% if (_required) { %>required<% } %>
        <% if (_maxLength) { %>
          maxlength="<%= _maxLength %>"
          data-max-length="<%= _maxLength %>"
        <% } %>
        <% if (_hasMessage && _validationId) { %>aria-describedby="<%= _validationId %>"<% } %>
        <% if (_isInvalid) { %>aria-invalid="true"<% } %>
        <% if (_isValid) { %>aria-invalid="false"<% } %>
      ><%= _value %></textarea>
    </div>
  
    <% if (_count) { %>
      <p class="textarea-meta">
        <span class="textarea-count" data-ui-textarea-count>0</span>
        <% if (_maxLength) { %><span class="textarea-max" data-ui-textarea-max><%= _maxLength %></span><% } %>
      </p>
    <% } %>
  </div>

  <!-- Validation 메시지 영역 -->
  <!-- NOTE: hidden 속성으로 표시/숨김 제어, is-invalid/is-valid에 따라 색상 변경 -->
  <div class="validation-message" <% if (!_hasMessage) { %>hidden<% } %>>
    <p <% if (_validationId) { %>id="<%= _validationId %>"<% } %> aria-live="polite"><%= _displayMessage %></p>
  </div>
</div>