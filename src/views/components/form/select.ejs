<% const _src = srcPath; const _public = publicPath; %>
<%
// params
// - id: string (선택) data-select-id로 식별
// - name: string (선택) hidden input name
// - placeholder: string (필수)
// - options: [{ value, text, disabled?, url? }] (필수)  // url 선택 지원
// - depth: 1|2|3 (선택: 브레드크럼 연동 시 사용)
// - disabled: boolean (선택)
// - value: string (선택: 초기 선택값)
// - root: string (선택: 브레드크럼 그룹 id, 같은 그룹끼리 연동)
// - className: string (선택) 최상단 .vits-select에 추가 클래스(스타일 분기용)
//   - size-s | size-l (사이즈 구분용)
%>

<%
  const _id = (typeof id !== 'undefined' && id !== null) ? String(id) : '';
  const _name = (typeof name !== 'undefined' && name !== null) ? String(name) : '';
  const _placeholder = placeholder || '선택';
  const _options = Array.isArray(options) ? options : [];
  const _depth = (typeof depth !== 'undefined' && depth !== null) ? String(depth) : '';
  const _disabled = !!disabled;
  const _value = (typeof value !== 'undefined' && value !== null) ? String(value) : '';
  const _root = (typeof root !== 'undefined' && root !== null) ? String(root) : '';
  const _className = (typeof className !== 'undefined' && className !== null) ? String(className) : '';

  // 연동형은 root+depth 동시 지정일 때만 허용
  const _isLinked = (_root !== '' && _depth !== '');

  const _selected = _options.find(function (o) {
    return o && String(o.value) === String(_value);
  });
  const _label = _selected ? (_selected.text || '') : _placeholder;

  const _portal = typeof portal !== 'undefined' && !!portal;
  const _maxHeight = (typeof maxHeight !== 'undefined' && maxHeight !== null) ? String(maxHeight) : '';
%>

<div
  class="vits-select<%= _className ? (' ' + _className) : '' %><%= _disabled ? ' vits-select-disabled' : '' %><%= _selected ? ' is-selected' : '' %>"
  data-vits-select
  <% if (_id !== '') { %> data-select-id="<%= _id %>" <% } %>
  <% if (_isLinked) { %> data-depth="<%= _depth %>" data-root="<%= _root %>" <% } %>
  <% if (_portal) { %> data-vits-select-portal <% } %>
  <% if (_maxHeight !== '') { %> data-max-height="<%= _maxHeight %>" <% } %>
>
  <button
    type="button"
    class="vits-select-trigger"
    aria-haspopup="listbox"
    aria-expanded="false"
    data-vits-select-trigger
    <%= _disabled ? 'disabled' : '' %>
  >
    <span
      class="vits-select-value"
      data-vits-select-value
      data-placeholder="<%= _placeholder %>"
    ><%= _label %></span>

    <span class="vits-select-icon" aria-hidden="true">
      <%- include(`${_src}/views/components/icon.ejs`, { iconName: 'arrow-down' }) %>
    </span>
  </button>

  <ul class="vits-select-list" role="listbox" tabindex="-1" data-vits-select-list>
    <% _options.forEach(function (opt) { 
      const optDisabled = !!(opt && opt.disabled);
      const optValue = opt && typeof opt.value !== 'undefined' ? String(opt.value) : '';
      const optText = opt && typeof opt.text !== 'undefined' ? String(opt.text) : '';
      const optUrl = opt && typeof opt.url !== 'undefined' ? String(opt.url) : ''; // 추가
      const isSelected = optValue !== '' && String(optValue) === String(_value);
    %>
      <li
        class="vits-select-option<%= optDisabled ? ' vits-select-option-disabled' : '' %><%= isSelected ? ' vits-select-selected' : '' %>"
        role="option"
        tabindex="-1"
        data-value="<%= optValue %>"
        <% if (optUrl) { %> data-url="<%= optUrl %>" <% } %>   <% // 추가: url 옵션 %>
        aria-selected="<%= isSelected ? 'true' : 'false' %>"
        <%= optDisabled ? 'aria-disabled="true"' : '' %>
      ><%= optText %></li>
    <% }) %>
  </ul>

  <% if (_name) { %>
    <input type="hidden" name="<%= _name %>" value="<%= _value %>" data-vits-select-hidden />
  <% } %>
</div>
