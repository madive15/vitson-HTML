<% const _src = srcPath; const _public = publicPath; %>

<!-- prettier-ignore -->
<%
  const _formClass = (typeof formClass !== 'undefined' && formClass) ? formClass : 'vits-input-search-form';
  const _id = (typeof idPrefix !== 'undefined' && idPrefix) ? idPrefix : 'plp';
  const _inputId = `${_id}-searchKeyword`;
  const _action = (typeof action !== 'undefined' && action) ? action : '';
  const _name = (typeof name !== 'undefined' && name) ? name : 'q';
  const _placeholder = (typeof placeholder !== 'undefined' && placeholder) ? placeholder : '결과 내 재검색';

  // ===== validation 옵션(추가) =====
  const _message = (typeof validationMessage !== 'undefined' && validationMessage) ? validationMessage : '';
  const _hasMessage = !!_message;

  const _isInvalidFlag = (typeof isInvalid !== 'undefined') ? (isInvalid === true) : false;
  const _isInvalid = _isInvalidFlag || _hasMessage;

  const _validationId = _inputId ? `${_inputId}-validation` : '';

  const _addClassNameRaw = (typeof addClassName !== 'undefined' && addClassName) ? addClassName : '';  
  const _addClassName = Array.isArray(_addClassNameRaw) ? _addClassNameRaw.filter(Boolean).join(' ') : String(_addClassNameRaw).trim();
  const _addBtnText = (typeof addBtnText !== 'undefined' && addBtnText) ? addBtnText : '';
  const _addDataForm = (typeof addDataForm !== 'undefined' && addDataForm) ? addDataForm : '';
  const _addDataInput = (typeof addDataInput !== 'undefined' && addDataInput) ? addDataInput : '';
%>

<div class="vits-input-search vits-validation<% if (_addClassName) { %> <%= _addClassName %><% } %>">
  <form 
    class="<%= _formClass %>" 
    role="search" 
    action="<%= _action %>" 
    method="get" 
    data-search-form
    <% if (_addDataForm) { %> data-<%= _addDataForm %><% } %>
  >
    <label for="<%= _inputId %>" class="sr-only">검색어</label>

    <input
      type="search"
      id="<%= _inputId %>"
      class="input-search"
      name="<%= _name %>"
      autocomplete="off"
      enterkeyhint="search"
      placeholder="<%= _placeholder %>"
      data-search-input
      <% if (_addDataInput) { %>data-<%= _addDataInput %><% } %>
      <% if (_hasMessage && _validationId) { %>aria-describedby="<%= _validationId %>"<% } %>
      <% if (_isInvalid) { %>aria-invalid="true"<% } %>
    />

    <button type="submit" class="input-search-btn" aria-label="검색">
      <%- include(`${_src}/views/components/icon.ejs`, { iconName: 'magnifying-glass' }) %>
      <% if (_addBtnText) { %> <span class="text"><%= _addBtnText %></span><% } %>
    </button>
  </form>

  <!-- validation 영역(교체) -->
  <div class="input-validation" <% if (!_hasMessage) { %>hidden<% } %>>
    <p <% if (_validationId) { %>id="<%= _validationId %>"<% } %> aria-live="polite"><%= _message %></p>
  </div>
</div>
