<!-- prettier-ignore -->
<%
  // 카테고리 트리 표시 여부 (기본: true)
  var showCategoryTree = locals.showCategoryTree !== false;
  // 공통 카테고리 필터 표시 여부 (기본: false)
  var showCommonCategory = locals.showCommonCategory === true;
%>

<%# PLP 전용 좌측 메뉴(카테고리/필터) %>
<aside class="vits-grid-side vits-grid-side-left vits-side-plp">
  <% if (showCategoryTree) { %> <%# 카테고리 트리 출력 영역(EJS에서 트리 마크업을 출력) %>
  <div class="plp-side-category">
    <p class="plp-side-title">카테고리</p>
    <%- include(`${_src}/views/components/category/category-tree.ejs`, { treeData: (mockData && mockData.category &&
    Array.isArray(mockData.category.tree)) ? mockData.category.tree : [], depth1Id: depth1Id, depth2Id: depth2Id,
    depth3Id: depth3Id }) %>
  </div>
  <% } %>

  <div class="plp-side-filter">
    <ul class="plp-side-filter-list">
      <li>
        <p class="plp-side-title">공통</p>
        <div class="plp-side-filter-items">
          <div class="plp-side-filter-item">
            <!-- prettier-ignore -->
            <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
            variant: 'basic',
            size: 'm',
            name: 'plpCommon',
            list: 'column',
            gap: 16,
            datas: [
              { text: '오늘출발', value: '오늘출발', checked: false, disabled: false, required: false },
              { text: '내일출발', value: '내일출발', checked: false, disabled: false, required: false },
              { text: '특가', value: '특가', checked: false, disabled: false, required: false },
            ]
          }) %>
          </div>
        </div>
      </li>

      <% if (showCommonCategory) { %>
      <!-- prettier-ignore -->
      <%
        // [D] 실제 데이터: 검색 키워드에 매칭된 카테고리만 전달
        var searchTreeRaw = (mockData && mockData.category &&
          Array.isArray(mockData.category.tree)) ? mockData.category.tree : [];

        // [D] 임의 수량 — 실제 연동 시 서버에서 categoryQty 전달
        var _mockQtyList = [245, 183, 156, 298, 124, 167, 89, 72, 134, 95];
        var searchTreeData = searchTreeRaw.map(function (item, idx) {
          var copy = {};
          for (var k in item) { copy[k] = item[k]; }
          if (copy.categoryQty === undefined || copy.categoryQty === null) {
            copy.categoryQty = _mockQtyList[idx % _mockQtyList.length];
          }
          return copy;
        });

        var _searchVisibleCount = 6;
        var _searchVisible = searchTreeData.slice(0, _searchVisibleCount);
        var _searchHidden = searchTreeData.slice(_searchVisibleCount);
        var _searchTotal = searchTreeData.length;
      %>
      <li data-search-more-scope>
        <p class="plp-side-title">카테고리</p>
        <div class="plp-side-filter-items">
          <%- include(`${_src}/views/components/category/category-tree-search.ejs`, { _src: _src, treeData:
          _searchVisible }) %> <% if (_searchHidden.length) { %>
          <div data-search-more-toggle style="display: none">
            <%- include(`${_src}/views/components/category/category-tree-search.ejs`, { _src: _src, treeData:
            _searchHidden }) %>
          </div>

          <div class="filter-more">
            <button type="button" class="filter-more-button" data-search-more-btn>
              <span class="icon"><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'plus' }) %></span>
              <span class="text">더보기 <em class="count">(<%= _searchTotal %>개)</em></span>
            </button>
          </div>
          <% } %>
        </div>
      </li>
      <% } %> <%# 4뎁스(속성) JS 삽입 위치 - 카테고리 트리가 표시될 때만 렌더링 %> <% if (showCategoryTree) { %>
      <li class="plp-side-filter-item is-hidden" data-plp-attr-anchor></li>
      <% } %>

      <!-- prettier-ignore -->
      <%
        var _brandList = [
          { code: 'brand_01', name: '삼성', count: 128 },
          { code: 'brand_02', name: 'LG', count: 94 },
          { code: 'brand_03', name: '현대', count: 61 },
          { code: 'brand_04', name: 'SK', count: 37 },
          { code: 'brand_05', name: '롯데', count: 42 },
          { code: 'brand_06', name: '포스코', count: 18 },
          { code: 'brand_07', name: '한화', count: 25 },
          { code: 'brand_08', name: 'CJ', count: 33 },
          { code: 'brand_09', name: '농심', count: 16 },
          { code: 'brand_10', name: '오뚜기', count: 21 },
          { code: 'brand_11', name: '아모레퍼시픽', count: 29 },
          { code: 'brand_12', name: '코웨이', count: 14 },
          { code: 'brand_13', name: '쿠쿠', count: 19 },
          { code: 'brand_14', name: '락앤락', count: 12 },
          { code: 'brand_15', name: '신세계', count: 27 }
        ];

        var _brandTotal = _brandList.length;
        var _brandVisibleCount = 7;
        var _brandVisible = _brandList.slice(0, _brandVisibleCount);

        var _brandDatas = _brandVisible.map(function (b) {
          return {
            text: (b.name || '') + ' (' + (b.count || 0) + ')',
            value: String(b.code || ''),
            checked: false,
            disabled: false,
            required: false
          };
        });

        var _brandHidden = _brandList.slice(_brandVisibleCount);
        var _brandHiddenDatas = _brandHidden.map(function (b) {
          return {
            text: (b.name || '') + ' (' + (b.count || 0) + ')',
            value: String(b.code || ''),
            checked: false,
            disabled: false,
            required: false
          };
        });
      %>
      <li data-search-more-scope>
        <p class="plp-side-title">브랜드</p>
        <div class="plp-side-filter-items">
          <div class="plp-side-filter-item">
            <!-- prettier-ignore -->
            <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
              variant: 'basic',
              size: 'm',
              name: 'plpBrand',
              list: 'column',
              gap: 16,
              datas: _brandDatas
            }) %>
          </div>

          <% if (_brandHiddenDatas.length) { %>
          <div data-search-more-toggle style="display: none">
            <div class="plp-side-filter-item">
              <!-- prettier-ignore -->
              <%- include(`${_src}/views/components/form/input-checkbox.ejs`, {
                variant: 'basic',
                size: 'm',
                name: 'plpBrand',
                list: 'column',
                gap: 16,
                datas: _brandHiddenDatas
              }) %>
            </div>
          </div>

          <div class="filter-more">
            <button type="button" class="filter-more-button" data-search-more-btn>
              <span class="icon"><%- include(`${_src}/views/components/icon.ejs`, { iconName: 'plus' }) %></span>
              <span class="text">더보기 <em class="count">(<%= _brandTotal %>개)</em></span>
            </button>
          </div>
          <% } %>
        </div>
      </li>
    </ul>
  </div>
</aside>
