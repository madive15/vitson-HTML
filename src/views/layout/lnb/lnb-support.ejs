<% const _src = srcPath; const _public = publicPath; %>
<!-- prettier-ignore -->
<% const _base = srcPath.includes('vitson-HTML') ? '/vitson-HTML' : ''; %>

<%
// 고객센터 메뉴
const gnbMenu = [
  { id: 'faq', label: 'FAQ', href: '/html/support/PC_CS_01010101.html' },
  { id: 'notice', label: '공지사항', href: '/html/support/PC_CS_01010101.html' },
  { id: 'inquiry', label: '1:1 문의', href: '/html/support/PC_CS_03020101.html' },
  {
    id: 'library',
    label: '자료실',
    href: '/html/support/library',
    children: [
      { id: 'library-named', label: '지명원', href: '#!' },
      { id: 'library-tax', label: '시국세 (전선)', href: '/html/support/PC_CS_04020101.html' },
    ],
  },
];

/* currentMenu key로 조상 id 탐색 */
const currentMenu = locals.currentMenu || '';

function findAncestorIds(items, targetId, ancestors = []) {
  for (const item of items) {
    if (item.id === targetId) return ancestors;
    if (item.children) {
      const result = findAncestorIds(item.children, targetId, [...ancestors, item.id]);
      if (result) return result;
    }
  }
  return null;
}

const ancestorIds = findAncestorIds(gnbMenu, currentMenu) || [];
%>

<%# 고객센터 전용 좌측 메뉴 %>
<aside class="vits-grid-side vits-grid-side-left vits-side-support">
  <h2 class="side-left-title">
    <a href="/support">고객센터</a>
  </h2>
  <nav class="side-left-nav" aria-label="고객센터 메뉴" data-toggle-scope>
    <ul class="side-left-list">
      <% gnbMenu.forEach((item) => {
        const hasChildren = item.children && item.children.length;
        const isSelfActive = currentMenu === item.id;
        const isAncestor = ancestorIds.includes(item.id);
      %>
      <li
        class="side-left-item<%= hasChildren ? ' has-sub' : '' %><%= (isSelfActive || isAncestor) ? ' is-active' : '' %>"
        data-menu-id="<%= item.id %>"
      >
        <% if (hasChildren) { %>
        <button
          type="button"
          class="side-left-link"
          data-toggle-btn
          data-toggle-target="<%= item.id %>"
          aria-expanded="true"
          data-aria-label-base="<%= item.label %>"
        >
          <%= item.label %>
          <span class="icon">
            <%- include(`${_src}/views/components/icon.ejs`, { iconName: 'arrow-down' }) %>
          </span>
        </button>
        <ul class="side-left-sub-list is-open" data-toggle-box="<%= item.id %>">
          <% item.children.forEach((sub) => { %>
          <li
            class="side-left-sub-item<%= currentMenu === sub.id ? ' is-active' : '' %>"
            data-menu-id="<%= sub.id %>"
          >
            <a class="side-left-link<%= currentMenu === sub.id ? ' is-active' : '' %>"
              href="<%= sub.href === '#!' ? '#!' : _base + sub.href %>"
              <% if (currentMenu === sub.id) { %>aria-current="page"<% } %>
            ><%= sub.label %></a>
          </li>
          <% }) %>
        </ul>
        <% } else { %>
        <a class="side-left-link<%= isSelfActive ? ' is-active' : '' %>"
          href="<%= item.href === '#!' ? '#!' : _base + item.href %>"
          <% if (isSelfActive) { %>aria-current="page"<% } %>
        ><%= item.label %></a>
        <% } %>
      </li>
      <% }) %>
    </ul>
  </nav>
</aside>
