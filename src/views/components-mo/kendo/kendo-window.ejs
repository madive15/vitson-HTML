<% const _src = srcPath; const _public = publicPath; %>

<%
/**
 * @file kendo-window.ejs
 * @description Kendo Window 모바일 컴포넌트
 * @scope [data-ui="kendo-window"]
 * @mapping PC kendo-window.ejs 대응
 * @state vm-kwindow(기본=modal) | type-bottom-sheet | type-alert
 *
 * @param {string} id - 윈도우 고유 ID (필수)
 * @param {string} variant - 표시 형태: 'modal' | 'bottomsheet' | 'alert' (선택, 기본 'modal')
 * @param {string} title - 헤더 타이틀 (필수)
 * @param {string} subtitle - 헤더 서브타이틀 (선택)
 * @param {string} infotitle - 헤더 인포타이틀 (선택)
 * @param {string} contentPath - 컨텐츠 EJS 파일 경로 (필수)
 * @param {object} opt - Kendo Window 옵션 (선택)
 * @param {array} buttons - 푸터 버튼 배열 (선택, 미입력시 푸터 없음)
 *   - {string} text: 버튼 텍스트
 *   - {string} variant: 'primary' | 'secondary' (기본 'primary')
 *   - {string} action: 'close' 입력 시 닫기 동작
 *   - {object} attrs: 추가 속성들
 *
 * @a11y role=dialog, aria-modal, aria-labelledby, aria-describedby, focus-trap, ESC 닫기
 * @note variant에 따라 type-* 클래스가 추가되며 SCSS에서 레이아웃/모션 분기
 */

const winId = id;
const winVariant = (typeof variant !== 'undefined' && variant) ? variant : 'modal';
const winTitle = (typeof title !== 'undefined' && title) ? title : '';
const winSubtitle = (typeof subtitle !== 'undefined' && subtitle) ? subtitle : '';
const winInfoTitle = (typeof infotitle !== 'undefined' && infotitle) ? infotitle : '';
const winContentPath = (typeof contentPath !== 'undefined' && contentPath) ? contentPath : '';
const winButtons = (typeof buttons !== 'undefined' && buttons) ? buttons : [];
const winHasFooter = (typeof hasFooter !== 'undefined') ? hasFooter : (winButtons.length > 0);
const winContentData = (typeof contentData !== 'undefined' && contentData) ? contentData : {};

const winTypeClassMap = { modal: '', bottomsheet: 'type-bottom-sheet', alert: 'type-alert' };
const winTypeClass = winTypeClassMap[winVariant] || '';

const winOpt = (typeof opt !== 'undefined' && opt) ? opt : {};
const winOptStr = JSON.stringify(winOpt);
%>

<div
  id="<%= winId %>"
  class="vm-kwindow<% if (winTypeClass) { %> <%= winTypeClass %><% } %>"
  data-ui="kendo-window"
  data-variant="<%= winVariant %>"
  data-opt='<%= winOptStr %>'
  role="dialog"
  aria-modal="true"
  aria-labelledby="<%= winId %>-title"
  <% const winDescribedBy = [winSubtitle ? `${winId}-subtitle` : '', winInfoTitle ? `${winId}-infotitle` : ''].filter(Boolean).join(' '); %>
  <% if (winDescribedBy) { %>aria-describedby="<%= winDescribedBy %>"<% } %>
  style="display:none;"
>
  <!-- 헤더 -->
  <div class="vm-kwindow-header">
    <div class="vm-kwindow-header-text">
      <h2 class="vm-kwindow-title" id="<%= winId %>-title"><%= winTitle %></h2>
<% if (winSubtitle) { %>
      <p class="vm-kwindow-subtitle" id="<%= winId %>-subtitle"><%= winSubtitle %></p>
<% } %>
<% if (winInfoTitle) { %>
      <p class="vm-kwindow-infotitle" id="<%= winId %>-infotitle"><%- winInfoTitle %></p>
<% } %>
    </div>
<% if (winVariant !== 'alert') { %>
    <button type="button" class="vm-kwindow-close" onclick="KendoWindow.close('<%= winId %>')" aria-label="닫기">
      <%- include(`${_src}/views/components/icon.ejs`, { iconName: 'x' }) %>
    </button>
<% } %>
  </div>

  <!-- 컨텐츠 -->
  <div class="vm-kwindow-content<% if (!winHasFooter) { %> no-footer<% } %>" data-scroll-check>
<% if (winContentPath) { %>
    <%- include(winContentPath, Object.assign({ size: undefined }, winContentData)) %>
<% } %>
  </div>

  <!-- 푸터 -->
<% if (winHasFooter) { %>
  <div class="vm-kwindow-footer">
<% if (winButtons.length > 0) { %>
    <div class="vm-kwindow-buttons <%= winButtons.length === 1 ? 'is-single' : 'is-double' %>">
<% winButtons.forEach(function(btn) {
  const btnType = btn.type || 'button';
  const btnVariant = btn.variant || 'primary';
  const btnAction = btn.action || '';
  const btnAttrs = btn.attrs || {};
%>
      <button type="<%= btnType %>" class="vm-kwindow-btn is-<%= btnVariant %>"<% if (btnAction === 'close') { %> onclick="KendoWindow.close('<%= winId %>')"<% } %><% Object.keys(btnAttrs).forEach(function(attrKey) { %> <%= attrKey %>="<%= btnAttrs[attrKey] %>"<% }); %>>
        <span class="text"><%= btn.text %></span>
      </button>
<% }); %>
    </div>
<% } %>
  </div>
<% } %>
</div>
