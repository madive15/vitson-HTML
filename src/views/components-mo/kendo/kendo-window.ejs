<% const _src = srcPath; const _public = publicPath; %>

<%
/**
 * Kendo Window Component (Mobile)
 * - Kendo UI Window 기반, vm-modal 스타일 사용
 * - 열기: VmKendoWindow.open('id')
 * - 닫기: VmKendoWindow.close('id')
 *
 * @param {string} id - 윈도우 고유 ID (필수)
 * @param {string} title - 헤더 타이틀 (필수)
 * @param {string} variant - 'bottomsheet' (선택, 미입력시 기본 모달)
 * @param {string} subtitle - 헤더 서브타이틀 (선택)
 * @param {string} infotitle - 헤더 인포타이틀 (선택)
 * @param {string} contentPath - 컨텐츠 EJS 파일 경로 (필수)
 * @param {object} contentData - 컨텐츠에 전달할 데이터 (선택)
 * @param {array} buttons - 푸터 버튼 배열 (선택, 미입력시 푸터 없음)
 *   - {string} text: 버튼 텍스트
 *   - {string} variant: 'primary' | 'secondary' (기본값: 'primary')
 *   - {string} action: 'close' 입력 시 닫기 동작
 *   - {object} attrs: 추가 속성들
 *
 * @example
 * < % const winOpts = { id: 'myWindow', title: '제목', variant: 'bottomsheet', contentPath: `${_src}/views/.../content.ejs`, buttons: [{ text: '취소', variant: 'secondary', action: 'close' }, { text: '확인', variant: 'primary', action: 'close' }] }; % >
 * < %- include(`${_src}/views/components-mo/kendo/kendo-window.ejs`, winOpts) % >
 */

const winId = id;
const winTitle = (typeof title !== 'undefined' && title) ? title : '';
const winVariant = (typeof variant !== 'undefined' && variant) ? variant : '';
const winSubtitle = (typeof subtitle !== 'undefined' && subtitle) ? subtitle : '';
const winInfoTitle = (typeof infotitle !== 'undefined' && infotitle) ? infotitle : '';
const winContentPath = (typeof contentPath !== 'undefined' && contentPath) ? contentPath : '';
const winButtons = (typeof buttons !== 'undefined' && buttons) ? buttons : [];
const winHasFooter = (typeof hasFooter !== 'undefined') ? hasFooter : (winButtons.length > 0);
const winContentData = (typeof contentData !== 'undefined' && contentData) ? contentData : {};
const winClassName = (typeof className !== 'undefined' && className) ? className : '';
%>

<div
  id="<%= winId %>"
  class="vm-modal-inner<%= winClassName ? ' ' + winClassName : '' %>"
  data-ui="kendo-window"
  <% if (winVariant) { %>data-variant="<%= winVariant %>"<% } %>
  role="dialog"
  aria-modal="true"
  aria-labelledby="<%= winId %>-title"
  <% const winDescribedBy = [winSubtitle ? `${winId}-subtitle` : '', winInfoTitle ? `${winId}-infotitle` : ''].filter(Boolean).join(' '); %>
  <% if (winDescribedBy) { %>aria-describedby="<%= winDescribedBy %>"<% } %>
  style="display:none;"
>
  <!-- 헤더 -->
  <div class="vm-modal-header">
    <div class="vm-modal-header-content">
      <h2 class="vm-modal-title" id="<%= winId %>-title"><%= winTitle %></h2>
<% if (winSubtitle) { %>
      <p class="vm-modal-subtitle" id="<%= winId %>-subtitle"><%= winSubtitle %></p>
<% } %>
<% if (winInfoTitle) { %>
      <p class="vm-modal-infotitle" id="<%= winId %>-infotitle"><%- winInfoTitle %></p>
<% } %>
    </div>
    <button type="button" class="vm-modal-close" onclick="VmKendoWindow.close('<%= winId %>')" aria-label="닫기">
      <%- include(`${_src}/views/components/icon.ejs`, { iconName: 'x' }) %>
    </button>
  </div>

  <!-- 컨텐츠 -->
  <div class="vm-modal-content<% if (!winHasFooter) { %> no-footer<% } %>" data-scroll-check>
  <% if (winContentPath) { %>
    <%- include(winContentPath, Object.assign({}, winContentData)) %>
  <% } %>
  </div>

  <!-- 푸터 -->
<% if (winHasFooter) { %>
  <div class="vm-modal-footer">
<% if (winButtons.length > 0) { %>
    <div class="vm-modal-buttons <%= winButtons.length === 1 ? 'is-single' : 'is-double' %>">
<% winButtons.forEach(function(btn) {
  const btnType = btn.type || 'button';
  const btnVariant = btn.variant || 'primary';
  const btnAction = btn.action || '';
  const btnAttrs = btn.attrs || {};
%>
      <button type="<%= btnType %>" class="vm-modal-btn vm-modal-btn-<%= btnVariant %>"<% if (btnAction === 'close') { %> onclick="VmKendoWindow.close('<%= winId %>')"<% } %><% Object.keys(btnAttrs).forEach(function(attrKey) { %> <%= attrKey %>="<%= btnAttrs[attrKey] %>"<% }); %>>
        <span class="text"><%= btn.text %></span>
      </button>
<% }); %>
    </div>
<% } %>
  </div>
<% } %>
</div>
